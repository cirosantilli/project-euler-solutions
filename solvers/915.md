# Project Euler 915 Solution - Giant GCDs

<https://projecteuler.net/problem=915>:

* [915.py](915.py)

This solution is written in pure Python (no external libraries). It computes and prints:

- \(T(10^8) \bmod 123456789\)

where

- \(s(1)=1\)
- \(s(n+1)=(s(n)-1)^3+2\)
- \(T(N)=\sum_{a=1}^{N}\sum_{b=1}^{N}\gcd\big(s(s(a)),\,s(s(b))\big)\)

The code asserts the test values provided in the problem statement.

---

## Main techniques

### 1) Reduce the GCD to a gcd on indices

Let \(f(x)=(x-1)^3+2\), and extend the definition with \(s(0)=0\) so that \(s(n)=f^n(0)\).
For any integer polynomial \(P\), the difference \(P(u)-P(v)\) is divisible by \(u-v\); applying this to iterates of \(f\) yields
\(s(n+t)\equiv s(t)\pmod{s(n)}\).
This congruence implies \(\gcd(s(m),s(n))=s(\gcd(m,n))\), and therefore
\(\gcd(s(s(a)),s(s(b)))=s(s(\gcd(a,b)))\).

### 2) Convert the double sum into a divisor sum

Group ordered pairs \((a,b)\) by \(d=\gcd(a,b)\): write \(a=dx\), \(b=dy\) with \(\gcd(x,y)=1\).
Then
\[
T(N)=\sum_{d\le N} s(s(d))\;C\!\left(\left\lfloor\frac{N}{d}\right\rfloor\right),
\]
where \(C(m)\) is the number of ordered coprime pairs \((x,y)\) with \(1\le x,y\le m\).

### 3) Express coprime pairs using the summatory totient

Let \(\Phi(m)=\sum_{k\le m}\varphi(k)\). A standard count gives
\(C(m)=2\Phi(m)-1\).

### 4) Compute \(\Phi(n)\) fast with quotient grouping and memoization

\(\Phi(n)\) is computed using the classic divide-and-conquer recurrence derived from
\(\sum_{d\mid n}\varphi(d)=n\), grouping ranges where \(\lfloor n/i\rfloor\) is constant.
This produces about \(O(\sqrt{n})\) distinct subproblems, cached in a dictionary.
A sieve precomputes \(\Phi\) up to a base limit to anchor the recursion.

### 5) Evaluate \(s(s(d))\) modulo 123456789 via eventual periodicity

For any modulus \(m\), the sequence \(s(n)\bmod m\) is finite-state, hence eventually periodic.
The code finds a preperiod \(\mu\) and period \(\lambda\) with Floyd cycle detection.
Using the cycle for modulus \(M=123456789\) and the cycle for modulus \(\lambda\), the value
\(s(s(n))\bmod M\) becomes periodic in \(n\) after a short prefix.
Precomputing one period and its prefix sums makes range sums of \(s(s(d))\) an \(O(1)\) operation.

### 6) Final summation in \(O(\sqrt{N})\) blocks

In the divisor sum, \(\lfloor N/d\rfloor\) changes only \(O(\sqrt{N})\) times.
The implementation iterates over blocks \([l..r]\) with constant \(q=\lfloor N/l\rfloor\),
gets \(\sum_{d=l}^{r} s(s(d))\) from the periodic prefix sums, gets \(C(q)=2\Phi(q)-1\),
and accumulates everything modulo 123456789.
