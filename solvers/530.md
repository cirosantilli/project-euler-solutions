# Project Euler 530 Solution - GCD of Divisors

<https://projecteuler.net/problem=530>:

* [530.py](530.py)

We are given

- \( f(n) = \sum_{d\mid n} \gcd(d, n/d) \)
- \( F(N) = \sum_{n=1}^{N} f(n) \)

and asked for \(F(10^{15})\).

## 1) Prime-power analysis → a clean divisor-square formula

For a prime power \(n=p^a\), the divisors are \(p^0,\dots,p^a\), and

\[
\gcd(p^i, p^{a-i}) = p^{\min(i,a-i)}.
\]

This leads to a standard identity (and can be verified by checking prime powers and using multiplicativity):

\[
f(n) \;=\; \sum_{k^2 \mid n} \varphi(k)\,\tau\!\left(\frac{n}{k^2}\right),
\]

where:

- \(\varphi\) is Euler’s totient,
- \(\tau\) is the divisor-counting function.

Define a sparse function \(b\) by:

- \(b(k^2)=\varphi(k)\),
- \(b(m)=0\) if \(m\) is not a square.

Then the identity is exactly the Dirichlet convolution:

\[
f = \tau * b.
\]

## 2) Turn \(F(N)\) into a 2D “lattice point” sum

Summing a convolution up to \(N\) gives:

\[
F(N)=\sum_{n\le N} ( \tau*b)(n)
     =\sum_{ij\le N} \tau(i)\,b(j).
\]

So the problem becomes evaluating the double sum over pairs \((i,j)\) with \(ij\le N\).

## 3) Dirichlet hyperbola method (the main speedup)

Let:

- \(k=\lfloor \sqrt{N}\rfloor\),
- \(l=\lfloor N/k\rfloor\),
- \(T(x)=\sum_{n\le x}\tau(n)\),
- \(B(x)=\sum_{m\le x}b(m)\).

The Dirichlet hyperbola method gives:

\[
\sum_{ij\le N}\tau(i)b(j)
=\sum_{i\le k}\tau(i)\,B(\lfloor N/i\rfloor)
+\sum_{j\le l}b(j)\,T(\lfloor N/j\rfloor)
- T(k)B(l).
\]

Here the special structure of \(b\) is crucial:

- \(b(j)\neq 0\) **only when \(j\) is a square**.

So the second sum has only \(\lfloor \sqrt{l}\rfloor \approx N^{1/4}\) terms.

### Prefix functions used

- \(B(x)=\sum_{j\le x} b(j) = \sum_{t^2\le x} \varphi(t) = \Phi(\lfloor \sqrt{x}\rfloor)\),
  where \(\Phi(m)=\sum_{t\le m}\varphi(t)\).
- \(T(x)=\sum_{n\le x}\tau(n)\) is the classic divisor summatory function:
  \[
  T(x)=\sum_{d\le x}\left\lfloor\frac{x}{d}\right\rfloor.
  \]
  It can be computed by the well-known square-root trick:
  \[
  T(x)=2\sum_{i=1}^{\lfloor \sqrt{x}\rfloor}\left\lfloor\frac{x}{i}\right\rfloor - \lfloor \sqrt{x}\rfloor^2.
  \]

## 4) Linear sieve for \(\varphi\) and \(\tau\)

We need \(\varphi(n)\) and \(\tau(n)\) for all \(n\le \lfloor\sqrt{N}\rfloor\) (about 31 million for \(10^{15}\)).

The code uses a **linear sieve** (Euler sieve) to compute both in \(O(n)\) time:

- \(\varphi\) recurrence:
  - if \(p\nmid i\): \(\varphi(ip)=\varphi(i)(p-1)\)
  - if \(p\mid i\): \(\varphi(ip)=\varphi(i)p\)
- \(\tau\) recurrence (tracking the exponent of the least prime factor).

We also build the prefix sum \(\Phi(m)=\sum_{t\le m}\varphi(t)\) for fast \(B(x)\) queries.

## Complexity notes

For \(N=10^{15}\):

- Sieve and prefix sums are \(O(\sqrt{N})\).
- The “square-only” second hyperbola sum has about \(N^{1/4}\approx 5600\) terms.
- Each \(T(x)\) query uses \(O(\sqrt{x})\) operations; the total work is dominated by the smallest squares (largest \(x\)).

The provided `main.py` finishes in reasonable time in CPython without any external libraries.

## Built-in checks from the statement

The code asserts:

- \(f(12)=8\)
- \(F(10)=32\)
- \(F(1000)=12776\)
