# Project Euler 897 Solution - Maximal $n$-gon in a region

<https://projecteuler.net/problem=897>:

* [897.py](897.py)

We want the maximal area `G(n)` of an `n`-gon contained in:

\[
R=\{(x,y)\in\mathbb{R}^2 : x^4 \le y \le 1\}.
\]

The problem asks for `G(101)` rounded to 9 decimal places.

---

## 1) Geometric Reduction to 1D

The region is convex and bounded above by the line `y=1` and below by the convex curve `y=x^4`.

For a maximal-area inscribed polygon:

- vertices can be pushed to the boundary without decreasing area,
- and the polygon can be taken convex.

A key structural fact is that an optimal polygon uses the full top boundary segment from `(-1,1)` to `(1,1)` as an edge, and all remaining vertices lie on the lower curve `y=x^4`.

So the polygon looks like:

- top edge: straight segment on `y=1`,
- bottom boundary: a polyline joining boundary points `(x_i, x_i^4)`.

Let:

\[
-1 = x_0 < x_1 < \dots < x_{n-2} < x_{n-1}=1.
\]

Then the bottom boundary is piecewise-linear interpolation of `f(x)=x^4` through these nodes, and the polygon area equals:

\[
G(n) = \int_{-1}^1 1\,dx - \int_{-1}^1 \text{(bottom polyline)}\,dx
     = 2 - \sum_{i=0}^{n-2} (x_{i+1}-x_i)\frac{x_i^4+x_{i+1}^4}{2}.
\]

Thus **maximizing `G(n)`** is the same as **minimizing the trapezoidal-rule sum** above.

---

## 2) First-Order Optimality ⇒ A Tridiagonal Nonlinear System

Let:

\[
T = \sum_{i} (x_{i+1}-x_i)\frac{x_i^4+x_{i+1}^4}{2}.
\]

Differentiate w.r.t. an internal node `x_k` and set to zero. This yields:

\[
x_{k-1}^4 - x_{k+1}^4 + 4x_k^3(x_{k+1}-x_{k-1}) = 0
\quad (1 \le k \le n-2).
\]

Each equation only links `x_{k-1}, x_k, x_{k+1}`, so the Jacobian matrix is **tridiagonal**.

---

## 3) Fast Newton Solve with a Tridiagonal Linear Solver

We solve the stationarity system using **damped Newton iteration**:

- build the residual vector,
- build the **tridiagonal Jacobian**,
- solve `J Δ = -g` via the **Thomas algorithm** (`O(n)`),
- apply a damping factor to keep nodes strictly increasing and reduce the residual.

This is efficient even for `n=101`.

---

## 4) Handling Odd `n`: Symmetry Can Be Suboptimal

A tempting (but incorrect) assumption is that the optimal node set must be symmetric for odd `n`.

In reality, for odd `n` there are typically two *mirror-image* asymmetric optima (same area), and the “forced symmetry” solution can be slightly worse.  
To avoid converging to the inferior symmetric local optimum, the implementation builds **two asymmetric initial guesses**, solves both, and takes the better result.

---

## 5) Numerical Stability

The final area sum is computed with **Kahan compensated summation** to reduce floating-point error before rounding to 9 decimals.

---

## Output

`main.py` asserts the example values from the statement and then prints `G(101)` to 9 decimal places.
