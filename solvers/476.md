# Project Euler 476 Solution - Circle Packing II

<https://projecteuler.net/problem=476>:

* [476.py](476.py)

This repository contains a standalone Python solution (no external libraries) for **Project Euler 476**.

## Key ideas

### 1) Geometry: the optimal 3-circle packing has only two cases
For a triangle with angles ordered **A ≤ B ≤ C**:

- **Circle 1** (largest) is always the **incircle** (radius `r`).
- **Circle 2** sits in the smallest corner **A**, tangent to the two sides and to the incircle.
- **Circle 3** is one of only two possibilities:
  1. **Corner B**: tangent to the incircle in the second-smallest corner.
  2. **Stack in corner A**: tangent to circle 2 (another circle in the same corner).

A simple inequality involving half-angles decides which option gives the maximum total area:
- if `sin(A/2) ≥ tan(B/4)`, pick **corner B**
- otherwise, pick the **stack in corner A**

This collapses what looks like a continuous optimization problem into a fixed formula per triangle.

### 2) Radii ratios from half-angles
If a circle of radius `q` is tangent to both sides of an angle `θ`, its center lies on the angle bisector. Using this, the radius ratio between the incircle (`r`) and the corner circle in angle `θ` is:

`q = r * (1 - sin(θ/2)) / (1 + sin(θ/2))`

So the area contribution uses only `r²` and `sin(θ/2)`.

### 3) Half-angle formulas from side lengths
With semiperimeter `s = (a+b+c)/2`:

- `r² = ((s-a)(s-b)(s-c)) / s`
- `sin(A/2)² = (s-b)(s-c) / (bc)`
- `sin(B/2)² = (s-a)(s-c) / (ac)`

The “case switch” is implemented without computing `tan(B/4)` explicitly by using an equivalent inequality:

`sin(A/2) ≥ tan(B/4)  ⇔  sin(B/2) ≤ 2 sin(A/2) / (1 + sin(A/2)²)`

### 4) Enumeration trick: use `x = a+b-c`
The constraints are:

`1 ≤ a ≤ b ≤ c < a+b ≤ n`

Let:

`x = a+b-c`  (so `c = a+b-x` and `1 ≤ x ≤ a`)

This parameterization makes many repeated expressions simpler and avoids recomputing `c` bounds.

### 5) Performance: precompute `sqrt(i)` and `1/sqrt(i)`
For the optimized run, the code precomputes tables for `sqrt(i)` and `1/sqrt(i)` for all integers `i ≤ 4n²`.
Half-angle sines then become **table lookups** plus a multiplication.

## Correctness checks
The script includes the exact checks given in the problem statement:

- `R(1,1,1) ≈ 0.31998`
- `S(2) ≈ 0.31998`
- `S(5) ≈ 1.25899`

## Running

```bash
python3 main.py        # computes S(1803)
python3 main.py 5      # computes S(5)
