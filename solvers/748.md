# Project Euler 748 Solution - Upside Down Diophantine Equation

<https://projecteuler.net/problem=748>:

* [748.py](748.py)

This solution computes the last 9 digits of

\[
S(N)=\sum (x+y+z)
\]

over all **primitive** integer triples \((x,y,z)\) satisfying

\[
\frac1{x^2}+\frac1{y^2}=\frac{13}{z^2},\quad 1\le x\le y\le N,\quad 1\le z\le N,\quad \gcd(x,y,z)=1.
\]

## 1) Rewriting the equation

Set

\[
\frac{z}{x}=\frac{p}{r},\qquad \frac{z}{y}=\frac{q}{r}.
\]

Then

\[
\left(\frac{p}{r}\right)^2+\left(\frac{q}{r}\right)^2 = 13
\quad\Longrightarrow\quad
p^2+q^2 = 13r^2.
\]

Using \(rz=px=qy\) and \(\gcd(p,q)=1\), one convenient integral choice is

\[
x = q r,\qquad y = p r,\qquad z = p q,
\]

and \(x\le y\) corresponds to \(q\le p\).

So the problem reduces to enumerating suitable integer solutions of

\[
p^2+q^2 = 13r^2
\]

and mapping each to \((x,y,z)\).

## 2) Gaussian integer parametrization

In \(\mathbb{Z}[i]\),

\[
p^2+q^2 = \lvert p+iq\rvert^2
\]

and \(13=3^2+2^2\), so a natural starting point is the Gaussian integer \(3+2i\).

All rational points on the circle \(P^2+Q^2=13\) can be generated by “rotating” \(3+2i\) by a unit complex rational. Writing that rotation as \(\frac{m+in}{m-in}\) gives

\[
P+iQ = (3+2i)\left(\frac{m+in}{m-in}\right)
      = (3+2i)\frac{(m+in)^2}{m^2+n^2}.
\]

Clearing denominators yields an integer solution to \(p^2+q^2=13r^2\) with

- \(r = m^2+n^2\),
- \((m+in)^2 = u + iv\) where \(u=m^2-n^2\) and \(v=2mn\),
- \((p+iq) = (3+2i)(u+iv)\).

Expanding the last product gives:

\[
p = \lvert 3u - 2v\rvert,\qquad q = \lvert 3v + 2u\rvert.
\]

Taking absolute values is important: the imaginary part can be negative, but the equation uses squares.

Finally, enforce \(p\ge q\) so that \(x=qr\le y=pr\).

A non-primitive family arises exactly when \(13\mid p\) and \(13\mid q\) (then also \(13\mid r\)); those are skipped.

## 3) Bounding the search

Because \(p\ge q\),

\[
p^2 \ge \frac{p^2+q^2}{2} = \frac{13}{2}r^2
\quad\Rightarrow\quad
y=pr \;\Rightarrow\; y^2 \ge \frac{13}{2}r^4.
\]

So if \(y\le N\) then

\[
r^4 \le \frac{2N^2}{13}.
\]

This provides a global limit on \(r\), and since \(r=m^2+n^2\), it bounds the \((m,n)\) search to a finite disk.

## 4) Summing modulo \(10^9\)

Only the last 9 digits are needed. The code accumulates the sum and periodically reduces modulo \(10^9\) to keep integers fast.

## 5) Verification

The program includes `assert`s for the check values in the problem statement:

- \(S(10^2)\)
- \(S(10^3)\)
- \(S(10^5)\)

Then it prints the last 9 digits for \(N=10^{16}\).
