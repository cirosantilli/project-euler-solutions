# Project Euler 481 Solution - Chef Showdown

<https://projecteuler.net/problem=481>:

* [481.py](481.py)

This solution treats the competition as a **finite stochastic game**.

## State model

A game position is:

- `mask`: a bitmask of chefs still alive
- `turn`: which chef (0‑based) is about to cook (always included in `mask`)

On each turn exactly **one dish** is cooked:

- with probability `1 - S[i]` the dish is unfavorable ⇒ nobody is eliminated, the turn advances
- with probability `S[i]` the dish is favorable ⇒ the current chef chooses **one** other chef to eliminate

All chefs act to **maximize their own eventual winning probability**.
If multiple eliminations are equally optimal, the tie is broken by eliminating the chef whose turn is **closest next** in the current cyclic order.

## Dynamic programming over subsets

Let:

- `W[mask][turn][k]` = probability chef `k` eventually wins from this state
- `E[mask][turn]` = expected number of remaining dishes cooked from this state

Eliminating a chef reduces the number of alive chefs, so we compute all values in increasing subset size (popcount of `mask`).

For a fixed `mask`, the only “non‑shrinking” transition is an **unfavorable** dish, which just rotates `turn` to the next chef.  
That means that for a given subset, all states form a **cycle** in turn order.

## Solving the cyclic linear system

For a fixed subset with `m` remaining chefs (in cyclic order), each turn state satisfies:

- `W_t = a_t * W_{t+1} + b_t`
- `E_t = 1 + a_t * E_{t+1} + c_t`

where:

- `a_t = 1 - S[current]`
- `b_t = S[current] * W(after optimal elimination)`
- `c_t = S[current] * E(after optimal elimination)`
- `t+1` wraps modulo `m`

This is a small **cyclic linear system**.  
We express every `W_t` (and `E_t`) as:

- `W_t = A_t * W_0 + B_t`

and enforce the cycle closure to solve for `W_0` using:

- `W_0 = A_0 * W_0 + B_0  ⇒  W_0 = B_0 / (1 - A_0)`

Then all other turns are obtained by substitution.

This avoids large generic matrix solvers and runs quickly for `n = 14`.

## Output

The program prints `E(14)` rounded to 8 decimal places and includes `assert`s for all numeric examples given in the problem statement.
