# Project Euler 944 Solution - Sum of Elevisors

<https://projecteuler.net/problem=944>:

* [944.py](944.py)

## Key idea

Instead of iterating over all subsets \(E \subseteq \{1,\dots,n\}\), swap the order of summation:

- For a fixed \(x\), count how many subsets contain \(x\) **and** at least one other multiple of \(x\).
- Multiply that count by \(x\), then sum over all \(x\).

This linearity-of-summation trick turns an exponential subset problem into an arithmetic summation.

## Counting subsets for a fixed \(x\)

Let \(k=\left\lfloor \frac{n}{x}\right\rfloor\).  
Among \(\{1,\dots,n\}\), the multiples of \(x\) are:

\[
x, 2x, 3x, \dots, kx
\]

For \(x\) to be an **elevisor** in subset \(E\):

1. \(x \in E\)
2. At least one element from \(\{2x,3x,\dots,kx\}\) is also in \(E\).

- Subsets with \(x\) included: \(2^{n-1}\)
- Subsets with \(x\) included but **no other multiple of \(x\)**:
  the other multiples are forbidden, leaving \(n-k\) free choices, so \(2^{n-k}\)

So the number of subsets where \(x\) contributes is:

\[
2^{n-1} - 2^{n-\lfloor n/x \rfloor}
\]

Therefore:

\[
S(n)=\sum_{x=1}^{n} x\left(2^{n-1}-2^{n-\lfloor n/x\rfloor}\right)
\]

## Modular rewrite

The hard part is:

\[
\sum_{x=1}^{n} x\cdot 2^{\,n-\lfloor n/x\rfloor}
\]

Let \(2^{-1}\) be the modular inverse of 2 (the modulus is odd in the problem), then:

\[
2^{n-\lfloor n/x\rfloor} = 2^n \cdot 2^{-\lfloor n/x\rfloor}
\]

So we compute:

\[
U=\sum_{x=1}^{n} x\cdot 2^{-\lfloor n/x\rfloor}\pmod m
\]

and multiply once by \(2^n\).

## Performance techniques used

### 1) Square-root split

Let \(B=\lfloor \sqrt{n}\rfloor\).

- For \(x \le B\): iterate \(x\) directly.
- For \(x > B\): \(\lfloor n/x \rfloor \le B\), so group those terms by the quotient \(q=\lfloor n/x \rfloor\), which correspond to contiguous integer intervals.

This yields about \(O(\sqrt{n})\) iterations.

### 2) Interval sums via arithmetic progressions

For a fixed quotient \(q\), the \(x\) such that \(\lfloor n/x \rfloor=q\) lie in:

\[
\left(\frac{n}{q+1},\frac{n}{q}\right]
\]

The sum of \(x\) over an interval \([l,r]\) is computed mod \(m\) using the arithmetic series formula.

### 3) Incremental exponent updates

When iterating \(x=1,2,3,\dots\), the quotient
\(\lfloor n/x \rfloor\) decreases, often by small steps.

If \(q\) decreases by \(\Delta\), then:

\[
2^{-q+\Delta} = 2^{-q} \cdot 2^{\Delta}
\]

Most \(\Delta\) values are small, so the implementation precomputes \(2^{\Delta}\) for \(\Delta\) up to a moderate bound and falls back to `pow(2, Î”, mod)` only for the first few large jumps.

---

The result is a fast modular computation suitable for \(n=10^{14}\) in pure Python without external libraries.
