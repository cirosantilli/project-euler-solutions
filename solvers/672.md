# Project Euler 672 Solution - One More One

<https://projecteuler.net/problem=672>:

* [672.py](672.py)

This repo contains a fast Python solution (no external libraries) for:

\[
H(K) = S\left(\frac{7^K - 1}{11}\right) \pmod{1\,117\,117\,717}
\]

where:
- `g(n)` = number of `+1` operations performed by the process
  - if `n = 1` stop
  - if `7 | n` then `n := n/7`
  - else `n := n + 1`
- `S(N) = \sum_{n=1}^N g(n)`

The program prints `H(10^9) mod 1_117_117_717`.

## Main techniques used

### 1) Block structure for `g` in base 7
Write `n = 7m + r` with `0 ≤ r ≤ 6`.

Before the process can divide by 7, it repeatedly adds 1 until reaching the next multiple of 7.
That means all numbers in the block:

\[
7m+1,\dots,7m+7
\]

share the same “next state” after the division (namely `m+1`), and their `g` values form a simple arithmetic progression:

\[
g(7m+t) = g(m+1) + (7-t)\quad (t=1..7,\ m\ge1)
\]

This makes partial sums inside each block easy.

### 2) A recurrence for `S(7m + r)`
Using the block observation and the special-case correction for `g(1)=0`, you can derive:

\[
S(7m+r) = 7S(m) + 21m + r\,g(m+1) + c_1(r)
\]

with a small precomputable constant:

\[
c_1(r) = -6 + \sum_{t=1}^{r}(7-t) = -6 + 7r - \frac{r(r+1)}{2}
\]

### 3) Track `g(m+1)` alongside `S(m)`
When you append one base-7 digit `r` (i.e. form `n = 7m + r`), you also need the next value `g(n+1)` for the following digit.
It updates with another tiny constant:

\[
 g(n+1) = g(m+1) + c_2(r),\qquad
 c_2(r) = \begin{cases}6-r,& r\in\{0,1,2,3,4,5\}\\0,& r=6\end{cases}
\]

So the state vector

\[
[S(m),\ g(m+1),\ m,\ 1]
\]

updates *affinely* when a digit is appended.

### 4) Turn the affine step into a 4×4 matrix
Affine updates become linear by adding a constant `1` component. Each base-7 digit `r` corresponds to a fixed 4×4 matrix.

Processing a digit sequence is just matrix multiplication.

### 5) Exploit the repeating base‑7 digits of \((7^K-1)/11\)
In base 7, the fraction `1/11` has a repeating expansion with period 10 (because 7 has order 10 modulo 11).
For `K` a multiple of 10, the integer

\[
\frac{7^K-1}{11}
\]

has base‑7 digits equal to that 10-digit period repeated.

So for `K=10^9`, the digit transformation matrix repeats `~10^8` times.
We accelerate this using fast exponentiation of the 10-digit **block matrix**, reducing the whole computation to `O(log K)` matrix multiplications.

## Complexity
- Time: `O(log K)` 4×4 matrix multiplications.
- Memory: `O(1)`.
