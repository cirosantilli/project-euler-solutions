# Project Euler 756 Solution - Approximating a Sum

<https://projecteuler.net/problem=756>:

* [756.py](756.py)

We want the expected error

\[
\Delta = S - S^*,
\quad
S=\sum_{k=1}^{n} f(k),
\quad
S^*=\sum_{i=1}^{m} f(X_i)\,(X_i-X_{i-1}),
\quad
0=X_0<X_1<\dots<X_m\le n
\]

where \((X_1,\dots,X_m)\) is uniformly chosen among all increasing \(m\)-tuples (equivalently, a uniformly random \(m\)-subset of \(\{1,\dots,n\}\)).

## Main technique: “successor” viewpoint + hockey-stick identity

Observe that \(S^*\) assigns the same value \(f(X_i)\) to every integer position in the interval \((X_{i-1}, X_i]\).  
Equivalently, define for each \(k\in\{1,\dots,n\}\):

- \(\mathrm{succ}(k)\) = the smallest sampled value \(\ge k\), if it exists, otherwise “none”.

Then:

\[
S^* = \sum_{k=1}^{n} f(\mathrm{succ}(k)),
\quad\text{with } f(\text{none})=0.
\]

So

\[
\mathbb{E}(\Delta)=\sum_{k=1}^{n} f(k) \;-\; \sum_{k=1}^{n}\mathbb{E}\!\left[f(\mathrm{succ}(k))\right].
\]

For a fixed \(k\) and \(j\ge k\), the event \(\mathrm{succ}(k)=j\) means:

- \(j\) is chosen, and
- no chosen element lies in \(\{k,k+1,\dots,j-1\}\).

Counting subsets gives:

\[
\Pr(\mathrm{succ}(k)=j)=\frac{\binom{n-(j-k+1)}{m-1}}{\binom{n}{m}}.
\]

Swapping the order of summation and applying the hockey-stick identity for binomials collapses the double sum to a single coefficient per \(j\), yielding the compact exact formula:

\[
\boxed{\;\mathbb{E}(\Delta)=\sum_{j=1}^{n} f(j)\,\frac{\binom{n-j}{m}}{\binom{n}{m}}\;}
\]

and since \(\binom{n-j}{m}=0\) when \(j>n-m\), the sum only needs \(j\le n-m\).

## Fast computation: recurrence for weights

Define the weight:

\[
w_j=\frac{\binom{n-j}{m}}{\binom{n}{m}}.
\]

Then

- \(w_1=\dfrac{\binom{n-1}{m}}{\binom{n}{m}}=\dfrac{n-m}{n}\)
- and the ratio update is:

\[
w_{j+1}=w_j\cdot \frac{n-j-m}{n-j}.
\]

This avoids computing huge binomial coefficients entirely and runs in \(O(J)\) time for however many terms \(J\) we include.

## Totients: Euler (linear) sieve

For the required function \(f(k)=\varphi(k)\), we compute all totients up to the needed cutoff using Euler’s linear sieve in \(O(N)\) time and memory.

## Numerical stability and truncation

All terms in the final sum are **nonnegative**, so there is no large cancellation. The implementation uses Kahan compensated summation.

For the problem’s large parameters, the weights \(w_j\) decrease rapidly. The solver optionally uses a **rigorous tail bound** based on \(\varphi(k)\le k \le n\) and monotonicity of \(w_j\) to stop early while guaranteeing the rounded-to-6-decimals result is unchanged.
