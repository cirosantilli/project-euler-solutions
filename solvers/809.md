# Project Euler 809 Solution - Rational Recurrence Relation

<https://projecteuler.net/problem=809>:

* [809.py](809.py)

## Key idea: a hidden Ackermann function

Write the input as `x = t + r` where `t` is an integer and `0 < r < 1`.
For `r = 1/n` (with `n ≥ 2`), the recurrence simplifies dramatically.
Define:

- `F_n(t) = f(t + 1/n)` for integers `t ≥ 0`.

Using the rules from the statement:

- `f(1/n) = f(n/(n-1)) = f(1 + 1/(n-1))`, so `F_n(0) = F_{n-1}(1)`.
- For `t > 0`, the “otherwise” branch gives
  `F_n(t) = f( 1/(n-1) + F_n(t-1) ) = F_{n-1}( F_n(t-1) )`.

That is exactly the Ackermann–Péter recurrence:

- `A(0, t) = t + 1`
- `A(m, 0) = A(m-1, 1)`
- `A(m, t) = A(m-1, A(m, t-1))`

with the identification `F_n(t) = A(n-1, t)`.

Since `22/7 = 3 + 1/7`, we need:

- `f(22/7) = F_7(3) = A(6, 3)`.

## Turning Ackermann into hyper-operations

For these parameters, Ackermann becomes a hyper-operation on base 2:

- `A(6, 3) + 3 = 2 ↑↑↑↑ 6` (hexation of 2).

So the answer is “a power-of-two monster minus 3”, which is perfect for modular arithmetic.

## Modulo `10^15`: split into `2^15` and `5^15`

We compute the result modulo `10^15 = 2^15 · 5^15` and combine with CRT.

### Mod `2^15`

`2 ↑↑↑↑ 6` is a (huge) power of two, so it is divisible by `2^15`.
Therefore:

- `A(6,3) ≡ -3 (mod 2^15)`.

### Mod `5^15`

Here `gcd(2, 5^15) = 1`, so exponents can be reduced through Euler’s totient.
The crucial observation is that when you chase the `↑↑↑↑` definition down, you quickly reach
inner tetrations whose *height* is already far larger than the length of the totient chain of `5^15`.
At that point, the residue is the same as for a “sufficiently tall” tower of twos.

So we compute a **stable tetration**:

- Choose a height `H = totient_chain_len(5^15) + 1`.
- Compute `T = 2 ↑↑ H (mod 5^15)` via recursion on `phi`.

Then:

- `A(6,3) ≡ T - 3 (mod 5^15)`.

Because totients of `5^k` introduce factors of 2 (`phi(5^k) = 4·5^{k-1}`), intermediate moduli are of the form
`2^a·5^b`. The implementation handles these by:

- solving mod `2^a` and mod `5^b` separately,
- recombining with the Chinese Remainder Theorem.

## What the code does

1. Runs the three sample asserts from the statement.
2. Computes the stable tetration residue modulo `5^15`.
3. Uses the `-3` shortcut modulo `2^15`.
4. Combines the two residues using CRT and prints the final value modulo `10^15`.
