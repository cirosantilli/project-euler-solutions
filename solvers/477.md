# Project Euler 477 Solution - Number Sequence Game

<https://projecteuler.net/problem=477>:

* [477.py](477.py)

This repository contains a standalone Python solution (no third‑party libraries) for **Project Euler 477: Number Sequence Game**.

## Techniques used

### 1) Game dynamic programming (for verification sizes)

For a sequence `a[i..j]`, let:

- `dp[i][j]` = maximum total the *current player* can obtain from the subarray `a[i..j]`.

Because all numbers are taken by the end, the opponent’s best total from the remaining numbers is subtracted from the subarray sum:

\[
dp[i][j] = \text{sum}(i..j) - \min(dp[i+1][j],\ dp[i][j-1]).
\]

This is the standard optimal-play recurrence for the “take from either end” game.

The implementation uses a **1D rolling DP** (computing `dp[i][*]` from `dp[i+1][*]`) to get **O(n²)** time and **O(n)** memory, which is fast enough for the check values up to `N = 10^4`.

### 2) Detecting eventual periodicity of the generator

The sequence is defined by:

\[
s_0=0,\quad s_{k+1} \equiv s_k^2+45 \pmod{1{,}000{,}000{,}007}.
\]

This is a functional graph over a finite set, so it must eventually repeat.
We find:

- **μ** = length of the preperiod (tail)
- **λ** = cycle length

using **Floyd’s cycle detection** (“tortoise and hare”).

For this specific recurrence:

- `μ = 57956`
- `λ = 7248`

Once `k ≥ μ`, values repeat with period `λ`, allowing **O(1)** random access to any `s_k` using a short stored prefix.

### 3) Collapsing the `N = 10^8` instance to an affine form

For the required `N = 10^8`, the tail of the sequence consists of many repeats of a larger block:

- `PERIOD = 8 * λ = 57984`.

With this period, the end-state of the generator repeats, and the game’s optimal value becomes **affine** in the number of full `PERIOD` blocks:

\[
F(\text{BASE\_LEN} + t\cdot \text{PERIOD})
= F(\text{BASE\_LEN}) + t \cdot \text{DIFF}.
\]

In the code:

- `BASE_LEN = 93568`
- `BASE_SCORE = F(BASE_LEN) = 23415402629325` (a fixed boundary value)
- `DIFF` is computed directly as a **parity sum** over one `PERIOD` block.

Then `F(10^8)` is computed as `BASE_SCORE + t*DIFF` after stripping as many full blocks as possible.

## Files

- `main.py` — solution + asserts for the given check values
- `README.md` — this explanation
