# Project Euler 784 Solution - Reciprocal Pairs

<https://projecteuler.net/problem=784>:

* [784.py](784.py)

## Core number theory reduction

A pair `(p,q)` with `p < q` is **reciprocal** if there exists `r < p` such that:

- `r ≡ p⁻¹ (mod q)`  →  `r p - k q = 1` for some integer `k ≥ 1`
- `r ≡ q⁻¹ (mod p)`  →  `r q - l p = 1` for some integer `l ≥ 1`

This gives a linear system:

```
r p - k q = 1
-l p + r q = 1
```

Its determinant is `d = r² - k l`. Solving by Cramer's rule yields:

- `p = (r + k) / d`
- `q = (r + l) / d`

Because `q > p` we must have `k < r`, and with `r < p` we get:

`r < (r+k)/d` ⇒ `d < 1 + k/r < 2` ⇒ **`d = 1`**.

So every reciprocal pair corresponds to positive integers `r,k,l` with:

- `r² - k l = 1`
- `p = r + k`, `q = r + l`, and `k < l`

Equivalently:

`k l = r² - 1`.

## Turning it into divisor enumeration

For a fixed `r ≥ 2`, let `n = r² - 1`. Every divisor `k | n` gives `l = n/k`.
The condition `p ≤ N` becomes:

`r + k ≤ N`  ⇒  `k ≤ N - r`.

Also `k < r` automatically implies `k < √(r²-1)`, hence `l > k` and `q > p`.

So we need all divisors:

`1 ≤ k ≤ min(r-1, N-r)`.

Each contributes:

`p + q = (r+k) + (r+l) = 2r + k + n/k`.

## Implementation techniques

- **Smallest prime factor sieve (SPF)** up to `N+1` to factor numbers `≤ N+1` quickly.
- Use `r² - 1 = (r-1)(r+1)` and the fact `gcd(r-1, r+1)` is `1` or `2`, so prime factors overlap only at `2`.
- **Generate divisors only up to a cutoff** (`min(r-1, N-r)`) to avoid producing large divisors that can’t satisfy `p ≤ N`.
- Accumulate the required sum directly from the divisor list.

The program includes asserts for the two test values given in the statement and prints `F(2·10⁶)`.
