# Project Euler 695 Solution - Random Rectangles

<https://projecteuler.net/problem=695>:

* [695.py](695.py)

This repository solves Project Euler problem 695 in pure Python (no third‑party libraries).

## Key ideas

### 1) Reduce the geometry to products of 1D gaps
For two points in the unit square, the rectangle area is

- `|x_i - x_j| * |y_i - y_j|`

So the problem separates naturally into an **x part** and a **y part**.

### 2) Sort coordinates and use gap/ratio coordinates
For three i.i.d. uniform points on `[0,1]`, sort the x‑coordinates:

- gaps: `a = x₂ - x₁`, `b = x₃ - x₂`
- span: `s = a + b`
- ratio: `t = a / (a + b)`

Then the three x‑distances are exactly `{s·t, s·(1-t), s}`.

The same transformation applies in y with span `r` and ratio `u`.

A crucial property of three uniform points in 1D:
- the ratio (`t` or `u`) is **uniform** on `[0,1]`
- the span has mean `E[span] = 1/2`

### 3) Use symmetry: only 6 relative permutations matter
We can fix the x‑order of labels as `1 < 2 < 3`.  
The y‑order can then be any of the 6 permutations, each equally likely.

Each permutation tells you whether a y‑distance uses:
- the lower gap (`u`)
- the upper gap (`1-u`)
- the full span (`1`)

### 4) Factor out the spans
All three rectangle areas share a factor `s·r`, so the “second largest” (median of three values) scales linearly too:

- `median(areas) = (s·r) * median(scaled_areas)`

Because x and y are independent:
- `E[s·r] = E[s]·E[r] = (1/2)·(1/2) = 1/4`

So the problem reduces to integrating only the **scaled** median over `(t,u)` and the 6 permutations.

### 5) Integrate over `t` exactly (piecewise linear)
For fixed `u` and a fixed permutation, the scaled values are:

- `p·t`, `q·(1-t)`, and `c` (constants in `t`)

The median of three linear functions is **piecewise linear**, with breakpoints where two expressions are equal.
That means the integral over `t ∈ [0,1]` can be computed **exactly** by splitting into a few intervals.

### 6) One remaining 1D integral, done by Gauss–Legendre quadrature
After the exact `t` integration, only a single integral over `u ∈ [0,1]` remains.
This is evaluated using a high‑order Gauss–Legendre rule implemented from scratch (Newton iteration on Legendre roots).

## Complexity
- Only a 1D quadrature loop remains.
- Each quadrature node evaluates 6 small piecewise‑exact integrals.
- Runs comfortably in a few seconds in standard CPython.

## Output
Running `python3 main.py` prints the required value rounded to 10 digits after the decimal point.
