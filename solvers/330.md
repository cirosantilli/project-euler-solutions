# Project Euler 330 Solution - Euler's Number

<https://projecteuler.net/problem=330>:

* [330.py](330.py)

We need the value

\[
(A(10^9) + B(10^9)) \bmod 77777777
\]

where \(A(n),B(n)\in\mathbb Z\) are defined by

\[
a(n)=\frac{A(n)e+B(n)}{n!}
\]

and

- \(a(n)=\sum_{i\ge 1} \frac{a(n-i)}{i!}\) for \(n\ge 0\)
- \(a(n)=1\) for \(n<0\)

## 1) Eliminate \(e\): work with \(S(n)=A(n)+B(n)\)

Because everything is *linear in* \(e\), it’s enough to track

\[
S(n) = A(n)+B(n).
\]

The answer requested by the problem is exactly \(S(10^9)\) modulo the given modulus.

The standard recurrence from the statement implies integer recurrences for \(A\) and \(B\), and adding them gives a recurrence for \(S\). That recurrence is not directly usable for \(n=10^9\), but it motivates a generating-function approach.

## 2) Use an exponential generating function in the **divided-power** basis

Define the exponential generating function

\[
\mathcal S(t) = \sum_{n\ge 0} S(n)\,\frac{t^n}{n!}.
\]

Working in the divided-power basis \(t^{[n]} = t^n/n!\) is crucial: multiplication satisfies

\[
t^{[i]}t^{[j]} = \binom{i+j}{i}t^{[i+j]},
\]

so products encode binomial sums “for free”.

From the recurrence one can derive the closed form

\[
\mathcal S(t) = \frac{1-e^t}{(1-t)(2-e^t)}.
\]

## 3) Prime moduli trick: \((e^t)^p \equiv 1 \pmod p\)

We compute the answer modulo each prime factor of

\[
77777777 = 7\cdot 11\cdot 73\cdot 101\cdot 137.
\]

In the divided-power ring modulo a prime \(p\),

\[
(e^t)^p = e^{pt} = \sum_{n\ge 0} p^n\,t^{[n]} \equiv 1 \pmod p,
\]

because \(p^n\equiv 0\) for \(n\ge 1\). Therefore **\(e^t\) behaves like a p-th root of unity**:

\[
E := e^t \quad\Rightarrow\quad E^p \equiv 1 \pmod p.
\]

This collapses rational functions in \(E\) into polynomials of degree \(<p\).

In particular, in the ring \(\mathbb F_p[E]/(E^p-1)\) we can compute

\[
\frac{1-E}{2-E}
\]

as a short polynomial \(\sum_{k=0}^{p-1} r_k E^k\). (There’s even a simple closed form for the inverse of \(2-E\) because multiplication by \(E\) is just a cyclic shift.)

## 4) Coefficients become a small finite sum

Because \(E^k = e^{kt}\), the coefficient of \(t^{[n]}\) in \(E^k\) is \(k^n\). After reducing modulo \(p\), the coefficient \(R_n\) of

\[
R(E)=\frac{1-E}{2-E}
\]

becomes a short sum

\[
R_n \equiv \sum_{k=1}^{p-1} r_k\,k^n \pmod p,
\]

which depends only on \(n\bmod(p-1)\) (by Fermat).

The remaining factor \((1-t)^{-1}\) is also *finite* modulo \(p\) because \(t^p=0\) in the divided-power algebra:

\[
(1-t)^{-1} = 1+t+t^2+\cdots+t^{p-1}.
\]

Putting it together yields, for any \(n\),

\[
S(n) \equiv \sum_{m=0}^{p-1} \binom{n}{m}\,m!\,R_{n-m} \pmod p.
\]

And because \(m<p\), Lucas’ theorem reduces \(\binom{n}{m} \bmod p\) to just the *lowest base-\(p\) digit* of \(n\).

So overall, \(S(n)\bmod p\) depends only on

- \(n \bmod p\) (from Lucas)
- \(n \bmod (p-1)\) (from Fermat)

and can be computed in \(O(p^2)\) precomputation + \(O(p)\) per query.

## 5) Chinese Remainder Theorem

Finally, we compute \(S(10^9)\) modulo each of the 5 primes and combine the residues with CRT to get the unique answer modulo \(77777777\).

## Files

- `main.py` — implementation (includes asserts for the example values in the statement)
- `README.md` — this explanation
