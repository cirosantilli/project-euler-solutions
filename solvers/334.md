# Project Euler 334 Solution - Spilling the Beans

<https://projecteuler.net/problem=334>:

* [334.py](334.py)

## Core idea
We study a 1D chip-firing (sandpile) system on an infinite line:

- A move removes 2 beans from position `i`
- Adds 1 bean to each neighbor `i-1` and `i+1`
- Stops when every position has 0 or 1 bean

The process is **Abelian**, so the final state and number of moves are unique.

---

## Technique 1 — Second moment invariant
Define the **second moment**:

\[
S_2 = \sum_i i^2 a_i
\]

A single move at position `i` changes it by:

\[
(i-1)^2 + (i+1)^2 - 2i^2 = 2
\]

So each move increases `S₂` by **exactly 2**, meaning:

\[
\text{moves} = \frac{S_{2,\text{final}} - S_{2,\text{initial}}}{2}
\]

Thus, we only need `S₂_final`.

---

## Technique 2 — Shape of the stabilized state
For the specific Euler input (1500 adjacent bowls each containing **bᵢ ≥ 2**):

- The stabilized configuration is always a **block of N+1 consecutive bowls**
- Every bowl contains **1 bean**, except **one missing position** (“hole”)

So the final state is:

\[
\{L, L+1, ..., L+N\} \setminus \{H\}
\]

---

## Technique 3 — Solving for block start and hole using conservation laws
Two quantities are conserved:

1. Total beans:
\[
\sum a_i = N
\]

2. First moment:
\[
\sum i a_i = S_1
\]

The block sum gives:

\[
S_1 = \left(\sum_{k=0}^N (L+k)\right) - H
\]

Solve:

\[
H = (N+1)L + \frac{N(N+1)}{2} - S_1
\]

and select the integer `L` such that:

\[
L \le H \le L+N
\]

---

## Technique 4 — Closed-form second moment
We compute:

\[
\sum_{k=0}^N (L+k)^2
\]

using:

- \(\sum k = N(N+1)/2\)
- \(\sum k^2 = N(N+1)(2N+1)/6\)

Then subtract \(H^2\).

---

## Result
The final number of moves for the required 1500 bowls is:

✅ **150320021261690835**
