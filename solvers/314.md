# Project Euler 314 Solution - The Mouse on the Moon

<https://projecteuler.net/problem=314>:

* [314.py](314.py)

We want the maximum possible ratio:

\[
\max \frac{\text{Area}}{\text{Perimeter}}
\]

for a closed wall made of straight segments connecting integer-grid posts inside a 500×500 square.

---

## 1) Symmetry Reduction (500 → 250)

The optimal wall can be assumed symmetric (reflecting across the square’s midlines).  
So we solve a reduced **250×250** “corner” problem and recover the same Area/Perimeter ratio for the full shape.

---

## 2) Fractional Programming (Dinkelbach’s Method)

Instead of directly maximizing \(A/P\), we iterate on a ratio \(r\) and solve:

\[
\max (A - rP)
\]

Given a current guess \(r\), we find the shape maximizing \(A - rP\), compute its true ratio \(A/P\), and update \(r\).  
This converges very quickly for this problem (a few iterations are typically enough).

---

## 3) Dynamic Programming for Fixed \(r\)

For a fixed \(r\), we build the best monotone convex lattice chain in the reduced grid.  
Each segment contributes:

- trapezoid area under the segment,
- minus \(r \times\) (Euclidean segment length).

This is a longest-path style DP over grid points.

---

## 4) Speed-up via Upper Envelope (“Distance Transform” Trick)

A naive transition would test all predecessors for every state (too slow).  
For fixed horizontal step \(dx\), the inner maximization over predecessor \(y\) becomes an upper-envelope problem of concave functions of \(j\).  
We maintain this envelope incrementally and compute switch points analytically, turning an expensive inner loop into a much faster scan.

---

## Implementation Notes

- The code includes assertions for the statement’s examples:
  - Square boundary ratio = **125**
  - Cutting four corner triangles of sides **75 m**, **75 m**, **75√2 m** gives ratio ≈ **130.87**
- A Numba-accelerated DP is used when available for practical runtime.
