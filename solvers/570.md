# Project Euler 570 Solution - Snowflakes

<https://projecteuler.net/problem=570>:

* [570.py](570.py)

This repository contains a fast pure-Python solution for Project Euler 570.

## Key ideas

### 1) Classify triangle “types” and use a transition matrix
The construction can be modeled by counting a small number of local triangle configurations (blue triangles with 1/2/3 adjacent red areas; yellow triangles with 0/1/2/3 adjacent green).  
This yields a **7×7 linear transition matrix** `M` whose powers describe how counts evolve with `n`.

The characteristic polynomial factors as:

\[
(x-4)^2 (x-3)^2 (x-1)^2 x
\]

So every component (and therefore `A(n)` and `B(n)`) is a linear combination of:

- \(4^n\), \(n4^n\)
- \(3^n\), \(n3^n\)
- \(n\) and constants

### 2) Closed forms for `A(n)` and `B(n)`
Fitting coefficients from a few initial values gives:

\[
A(n) = 3\cdot4^{n-1} - 2\cdot3^{n-1}
\]

\[
B(n) = -138\cdot4^{n-2} + 18n4^{n-2} + 26\cdot3^{n-1} + 4n3^{n-1}
\]

### 3) Reduce `G(n)=gcd(A(n),B(n))` to a modular gcd
After algebraic simplification:

\[
G(n) = 6\cdot \gcd\left(2\cdot 4^{\,n-2} - 3^{\,n-2},\ 7n+3\right)
\]

So for each `n` we only need a gcd with a modulus of size about `7n`.

### 4) Cancel an invertible factor when `n mod 3 != 0`
Let \(m = 7n+3\). When \(3 \nmid n\), we also have \(3 \nmid m\), so \(3^{n-2}\) is invertible modulo `m`.

Rewrite:

\[
2\cdot4^{n-2} - 3^{n-2} \equiv 3^{n-2}\left(2\left(\frac{4}{3}\right)^{n-2}-1\right) \pmod m
\]

Therefore:

\[
\gcd(2\cdot4^{n-2} - 3^{n-2}, m)=\gcd\left(2\cdot b^{n-2}-1,\ m\right)
\]
where \(b \equiv 4\cdot 3^{-1} \pmod m\).

This turns **two modular exponentiations into one** for 2/3 of all `n`.

### 5) O(1) modular inverse of 3
For `m` not divisible by 3:

- If \(m=3k+1\), then \(3^{-1} \equiv 2k+1 = (2m+1)/3\)
- If \(m=3k+2\), then \(3^{-1} \equiv k+1  = (m+1)/3\)

So we avoid extended-gcd inside the hot loop.

### 6) Fast summation up to \(10^7\)
The final sum is computed in ~linear time by looping `n` in three arithmetic progressions (by `n mod 3`), using Python’s optimized `pow(base, exp, mod)` and `math.gcd`.

The program prints:

\[
\sum_{n=3}^{10^7} G(n) = 271197444
\]

## Files
- `main.py` — implementation + statement asserts
- `README.md` — this summary
