# Project Euler 584 Solution - Birthday Problem Revisited

<https://projecteuler.net/problem=584>:

* [584.py](584.py)

This solution computes the **expected number of people** entering a room until we first find:

- `K` people whose birthdays are **within `D` days of each other**
- birthdays are uniform on a year with `N` days
- **wrap-around counts** (the year is circular)

It matches the two sample values from the statement and prints the Earth answer.

---

## 1) Turn “within D days” into a window constraint

In discrete days, “within `D` days” means all `K` birthdays lie inside some block of  
`D+1` consecutive days.

So the **complement** event (“not yet found such a group”) is:

> every window of length `W = D+1` contains at most `K-1` birthdays.

For Earth: `W=8`, `K=4` ⇒ every 8-day window has sum ≤ 3.

---

## 2) Use an exponential generating function

Let:

- `p_n = P(no success after n people)`

Then:

\[
\mathbb{E}[T] = \sum_{n\ge 0} p_n
\]

Define the exponential generating function:

\[
G(t) = \sum_{n\ge 0} p_n \frac{t^n}{n!}
\]

A key identity is:

\[
\sum_{n\ge 0} p_n = \int_0^\infty e^{-t} G(t)\,dt
\]

because:

\[
\int_0^\infty e^{-t}\frac{t^n}{n!}dt = 1
\]

So we just need to compute `G(t)` for some `t` values and integrate with the weight `e^{-t}`.

---

## 3) Transfer matrix on “last W−1 days” states

We work with day-counts \(c_0,\ldots,c_{N-1}\) (how many birthdays fall on each day).

Under the EGF, each day contributes a factor:

\[
\frac{(t/N)^{c}}{c!}
\]

The window constraint (“every length `W` window has sum ≤ `K−1`”) depends only on the
last `W−1` day counts. That gives a finite state space:

- state = tuple of the last `W−1` counts
- only states with sum ≤ `K−1` are allowed
- transition = append today’s count `c` such that sum(state)+c ≤ `K−1`

Wrap-around is enforced by counting **cyclic** sequences, which is done by taking a
**trace** of the transfer matrix power.

---

## 4) Computing `G(t)` as a trace

Let `M(t)` be the weighted transition operator.

Then:

\[
G(t) = \mathrm{trace}(M(t)^N)
\]

Intuition: a length-`N` closed walk corresponds to a cyclic day-count sequence, i.e.
a full year with wrap-around windows enforced.

---

## 5) Integrate with Gauss–Laguerre quadrature

We need:

\[
\int_0^\infty e^{-t} G(t)\,dt
\]

Gauss–Laguerre quadrature is designed exactly for integrals of the form:

\[
\int_0^\infty e^{-t} f(t)\,dt \approx \sum_i w_i f(x_i)
\]

The program computes nodes/weights via Newton refinement of Laguerre polynomial roots
(no external libraries) and uses `quad_n=28`, which is enough to get the final answer
correct to 8 decimals.

---

## 6) Validation

The solution asserts the two statement values:

- WimWi (10-day year, 3 people within 1 day) → `5.78688636`
- Joka (100-day year, 3 people within 7 days) → `8.48967364`

Then it prints the Earth answer (365-day year, 4 people within 7 days).
