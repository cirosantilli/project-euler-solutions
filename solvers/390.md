# Project Euler 390 Solution - Triangles with Non Rational Sides and Integral Area

<https://projecteuler.net/problem=390>:

* [390.py](390.py)

We look at triangles with side lengths

- \(\sqrt{1+b^2}\),
- \(\sqrt{1+c^2}\),
- \(\sqrt{b^2+c^2}\),

for positive integers \(b,c\). Let \(S(n)\) be the **sum of areas** of all such triangles whose area is an **integer** and \(\le n\).

## 1) Simplifying the area condition

Using the identity (from Heronâ€™s formula)

\[
16\Delta^2 = 2x^2y^2 + 2y^2z^2 + 2z^2x^2 - x^4 - y^4 - z^4,
\]

with \(x^2=1+b^2\), \(y^2=1+c^2\), \(z^2=b^2+c^2\), everything cancels nicely and we get

\[
\Delta \;=\; \frac12\sqrt{b^2c^2+b^2+c^2}.
\]

So the area is an integer iff

\[
b^2c^2+b^2+c^2 \;=\; 4A^2
\]

for some integer \(A\) (the area).

### Parity
The left side is divisible by 4 only when **both** \(b\) and \(c\) are even, so write

\[
b=2p,\quad c=2q.
\]

Then the condition becomes

\[
A^2 = 4p^2q^2 + p^2 + q^2
\quad\Longleftrightarrow\quad
A^2 - (4p^2+1)q^2 = p^2.
\]

This is a *generalized Pell equation* in \((q,A)\) for each fixed \(p\).

## 2) Pell-type recurrence (fixed \(p\))

For \(D=4p^2+1\), the unit

\[
(8p^2+1) + 4p\sqrt{D}
\]

has norm 1, and multiplying a solution \((q,A)\) by this unit produces the next one:

\[
\begin{aligned}
q' &= (8p^2+1)q + 4pA,\\
A' &= 4p(4p^2+1)q + (8p^2+1)A.
\end{aligned}
\]

Starting from the seed \((q,A)=(0,p)\), one step already yields the smallest positive solution
\((q,A)=(4p^2,\;p(8p^2+1))\).

## 3) Symmetry branching to get *all* triangles

The original equation

\[
A^2 = 4p^2q^2 + p^2 + q^2
\]

is symmetric in \(p\) and \(q\). Also, changing the sign of \(p\) or \(q\) does not change the triangle
(because only squares matter), but it *does* matter for generating distinct solution branches.

So from each generated solution we branch into three subproblems:

1. continue the Pell sequence for the same \(p\),
2. swap \((p,q)\),
3. swap and negate \((p,q)\).

A depth-first search over this tree enumerates each valid triangle exactly once, summing its area.

## 4) Bounding the starting seeds

For fixed \(p>0\), the smallest positive-area solution is \(A = p(8p^2+1)\).
If \(8p^3+p > N\), no solution under this \(p\) can contribute to \(S(N)\).

We therefore start DFS seeds only for

\[
p \le \max\{p : 8p^3+p \le N\},
\]

found via integer binary search.

## 5) Complexity

The algorithm is essentially **linear in the number of valid solutions** (each solution generates a constant
amount of big-integer arithmetic). For \(N=10^{10}\), it runs quickly in pure Python.
