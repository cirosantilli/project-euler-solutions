# Project Euler 593 Solution - Fleeting Medians

<https://projecteuler.net/problem=593>:

* [593.py](593.py)

This solution computes:

- `S(k) = p_k^k mod 10007` where `p_k` is the *k*‑th prime
- `S2(k) = S(k) + S(floor(k/10000)+1)`
- `M(i,j)` = median of `S2(i)..S2(j)`
- `F(n,k) = sum_{i=1..n-k+1} M(i, i+k-1)`
- Target: `F(10^7, 10^5)` (printed with `.0` / `.5`)

## Main techniques used

### 1) Segmented sieve for the first 10,000,000 primes
The 10,000,000‑th prime is about 1.8×10^8, so a plain sieve up to that bound would be too big as one array in Python.
A **segmented sieve** processes the range in chunks (segments) and marks composites using the primes up to `sqrt(limit)`.

### 2) Fast modular exponentiation via discrete log tables (because 10007 is prime)
Since `10007` is prime, the nonzero residues form a cyclic multiplicative group of size `10006`.
We find a primitive root `g` and build:

- `exp[i] = g^i mod 10007`
- `log[a] = i` such that `g^i ≡ a (mod 10007)`

Then for `a != 0`:

`a^e mod 10007 = exp[(log[a] * e) mod 10006]`

This replaces 10 million calls to `pow(a,e,MOD)` with a couple of integer ops + table lookups.

### 3) Sliding window median using counting + “drifting” pointer
`S(k)` is in `[0, 10006]` so `S2(k)` is in `[0, 20012]` — a tiny domain.
Instead of heaps or a Fenwick tree, we keep a **frequency array** `counts[0..20012]` for the current window.

We maintain:

- `m1` = value of the lower middle element (rank `k/2` for even `k`)
- `below` = how many elements are `< m1`

After each add/remove, `m1` only needs to drift a small distance until
`below < rank <= below + counts[m1]` is restored.

For even `k`, the upper middle value is either the same as `m1` (if there’s another copy)
or the next value with nonzero count.

This gives very fast per-step updates.

### 4) Integer arithmetic for half values
Medians (and thus `F`) can be half-integers. We accumulate `2*F` as an integer (`sum2`)
and format the final answer as `... .0` or `... .5`.

## Files

- `main.py` — computes and prints the answer, and asserts the examples from the problem statement.
