# Project Euler 379 Solution - Least Common Multiple Count

<https://projecteuler.net/problem=379>:

* [379.py](379.py)

We want the number of pairs `(x, y)` with `1 ≤ x ≤ y` such that:

> `lcm(x, y) ≤ N`

---

## 1) Key transformation

A classical counting identity is:

- The number of **ordered** pairs `(a, b)` whose `lcm(a, b) = n` equals:

\[
\tau(n^2)
\]

So if we define:

\[
L(N) = \sum_{n \le N} \tau(n^2)
\]

then `L(N)` counts **ordered** pairs `(a, b)` with `lcm(a, b) ≤ N`.

To convert to unordered pairs with `x ≤ y`:

- Off-diagonal pairs occur twice: `(x,y)` and `(y,x)`
- Diagonal pairs `(x,x)` occur once, and always satisfy `lcm(x,x)=x`

Thus:

\[
g(N) = \frac{L(N) + N}{2}
\]

---

## 2) Why this is not brute force

Brute forcing `(x, y)` is impossible for `N = 10^{12}`.

Instead we compute the summatory function:

\[
\sum_{n \le N} \tau(n^2)
\]

directly using fast multiplicative summation techniques.

---

## 3) Multiplicative structure

The function:

\[
f(n) = \tau(n^2)
\]

is multiplicative and satisfies:

\[
f(p^e) = 2e + 1
\]

This makes it suitable for **Min_25-style multiplicative summation**.

---

## 4) Lucy sieve + “un-Lucy” (Min_25 style)

The method works in two phases over a special set of **key values**:

\[
V = \{\lfloor N/i \rfloor\}
\]

There are only about `2*sqrt(N)` such values, and they allow efficient divide-grouping.

### Phase A — Lucy sieve (prime counting)

Initialize:

\[
S(v) = v - 1
\]

and sieve it to become:

\[
S(v) = \pi(v)
\]

for all key values `v`.

### Phase B — Convert to prime sum for `f(p)`

Since:

\[
f(p) = \tau(p^2) = 3
\]

we get:

\[
\sum_{p \le v} f(p) = 3\pi(v)
\]

### Phase C — “Un-Lucy” expansion

We then expand prime sums into full multiplicative sums using:

- prime powers `p^e`
- recursion based on smallest prime factor
- the multiplicative rule `f(p^e)=2e+1`

After this phase:

\[
S(N) = \sum_{2 \le k \le N} f(k)
\]

and we finally add `f(1)=1`.

---

## 5) Complexity notes

- Uses key values: about `2*sqrt(N)`
- Avoids iterating over all `n ≤ N`
- Uses only integer arithmetic and sieve logic

This approach is a standard technique for very large summatory multiplicative functions.

---

## 6) Validation

The implementation includes the known statement check:

- `g(10^6) = 37429395`
