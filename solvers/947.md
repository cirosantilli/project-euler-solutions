# Project Euler 947 Solution - Fibonacci Residues

<https://projecteuler.net/problem=947>:

* [947.py](947.py)

This repository contains a standalone `main.py` that computes

\[ S(10^6) = \sum_{m=1}^{10^6} s(m) \pmod{999\,999\,893} \]

where

- `p(a,b,m)` is the period of the recurrence
  \(g(n)=g(n-1)+g(n-2)\; (\bmod\; m)\) with \(g(0)=a\), \(g(1)=b\),
- \(s(m)=\sum_{a=0}^{m-1}\sum_{b=0}^{m-1} p(a,b,m)^2\).

The code includes brute-force asserts for the small values given in the problem statement.

---

## Main techniques used

### 1) Linear algebra view of the recurrence
The state \((g(n), g(n+1))\) evolves by multiplying with the *Fibonacci Q-matrix*

\[
A = \begin{pmatrix}0 & 1\\ 1 & 1\end{pmatrix}\; (\bmod\; m).
\]

So the period `p(a,b,m)` is the cycle length of the vector \((a,b)\) under the permutation
induced by repeated multiplication by `A` modulo `m`.

A crucial identity used for fast checks is

\[
A^n = \begin{pmatrix}F_{n-1} & F_n\\ F_n & F_{n+1}\end{pmatrix},
\]

which means `A^n = I (mod p)` iff \(F_n\equiv 0\) and \(F_{n+1}\equiv 1\) modulo `p`.

### 2) Primitive-pair decomposition (gcd scaling)
If \(d\mid m\) divides both \(a\) and \(b\), then scaling out that factor reduces the modulus:

- write \(a=d a'\), \(b=d b'\), \(m=d m'\)
- the period modulo `m` equals the period of \((a',b')\) modulo `m'`.

This lets us rewrite the full sum in terms of *primitive pairs*
\(\gcd(a,b,m)=1\) and yields

\[
S(M)=\sum_{n\le M} P(n)\,\Big\lfloor \frac{M}{n}\Big\rfloor
\]

where `P(n)` is the sum of squared periods over primitive pairs modulo `n`.

### 3) Chinese Remainder Theorem (CRT)
For \(n=\prod p_i^{e_i}\), the module \((\mathbb{Z}/n\mathbb{Z})^2\) splits into a product of
prime-power components.

- primitive-ness also splits (for each prime, not both coordinates are divisible by it)
- the period modulo `n` is the **lcm** of the periods in each prime-power component

So `P(n)` can be computed by combining small per-prime-power distributions.

### 4) Prime-power period distributions are tiny
For each prime power \(q=p^e\), primitive pairs take only **one or two** possible periods:

- most primes: all primitive pairs have full Pisano period \(\pi(p^e)\)
- for some primes with \((5/p)=1\): an extra class has period \(\pi(p^e)/2\)
- for `p=5`: an extra class has period \(\pi(5^e)/5\)

Counts for the short-period class can be written in closed form, so for each `p^e` we only
need a distribution of size 1â€“2.

### 5) Fast Pisano periods for primes
For primes \(p\ne 2,5\):

- if \((5/p)=1\), then \(\pi(p)\mid (p-1)\)
- otherwise \(\pi(p)\mid 2(p+1)\)

The code factors that candidate value (using a smallest-prime-factor sieve) and reduces it
by checking divisors with fast-doubling Fibonacci computations.

---

## Files

- `main.py`: implementation + required asserts
- `README.md`: this summary
