# Project Euler 606 Solution - Gozinta Chains II

<https://projecteuler.net/problem=606>:

* [606.py](606.py)

## 1) Gozinta chains = ordered factorizations

A gozinta chain for `n` is a strictly increasing divisor chain:

`{1 = d0 < d1 < ... < dk = n}` with `di | d(i+1)`.

Define `ri = d(i+1) / di`. Then each `ri > 1` and:

`n = r0 * r1 * ... * r(k-1)`.

Conversely, any **ordered factorization** of `n` into integers `> 1`
produces a gozinta chain by taking partial products.

✅ Therefore:

> **Number of gozinta chains g(n) = number of ordered factorizations of n into factors > 1.**

This is the “ordered multiplicative partition” function.

---

## 2) Classifying `g(n) = 252` by prime-exponent signature

Let:

`n = ∏ p_i^{e_i}`.

An ordered factorization corresponds to splitting each exponent `e_i`
among the ordered factors (stars-and-bars), with inclusion-exclusion to ensure
no factor equals 1. That means `g(n)` depends only on the exponent vector `(e_i)`.

A systematic search over exponent partitions (small because 252 is small)
shows:

> The **only** exponent signature producing `g(n) = 252` is `(3,3)`.

Thus:

> **g(n) = 252  ⇔  n = p^3 q^3 with distinct primes p ≠ q.**

So every qualifying number is:

`n = (p*q)^3` where `p < q` are primes.

---

## 3) Reducing the required sum `S(N)`

The problem asks:

`S(N) = Σ_{k ≤ N, g(k)=252} k`.

Using the characterization above:

`k = (p*q)^3` and `k ≤ N` ⇔ `p*q ≤ floor(N^(1/3)) = M`.

So:

`S(N) = Σ_{p<q, p*q ≤ M} (p*q)^3
      = Σ_{p<q, p*q ≤ M} p^3 q^3`.

For the actual problem:

`N = 10^36  →  M = 10^12`.

The final answer requests the **last nine digits**, so we compute modulo `10^9`.

---

## 4) Fast computation via prime cube prefix sums (Lucy-style sieve)

To compute:

`Σ_{p<q, p*q≤M} p^3 q^3`

we iterate over the *smaller* prime `p` (it must satisfy `p ≤ sqrt(M)`), and for each `p` need:

`Σ_{q prime, p < q ≤ M/p} q^3`.

If we define a prefix function:

`P3(x) = Σ_{prime ≤ x} prime^3`,

then the needed inner sum is:

`P3(M/p) - P3(p)`.

The hard part is computing `P3(x)` for huge `x` (up to `5×10^11`) without enumerating primes.

### Lucy / combinatorial prime summatory sieve

We build the standard key set:

`V = { floor(M / i) } ∪ {1..sqrt(M)}`

which has about `2*sqrt(M)` distinct values.

Initialize:

`S(v) = Σ_{k=2..v} k^3 (mod 10^9)` using the closed form:

`Σ_{k=1..v} k^3 = (v(v+1)/2)^2`.

Then we sieve composites out using:

`S(v) -= p^3 * ( S(floor(v/p)) - S(p-1) )`

for each prime `p` and each key `v ≥ p^2`.

After processing all primes `p ≤ sqrt(M)`, the remaining values are exactly primes,
so:

`S(v) = P3(v) (mod 10^9)`.

Finally:

`answer = Σ_{p prime, p < sqrt(M)} p^3 * ( P3(M/p) - P3(p) ) (mod 10^9)`.

---

## 5) Validation

The statement provides:

- `S(10^6)  = 8462952`
- `S(10^12) = 623291998881978`

For these smaller bounds, `M = floor(N^(1/3))` is at most `10^4`,
so brute enumeration over prime pairs is feasible and is used as assertions.

---

## Output

The program prints the **last nine digits** of `S(10^36)` (with leading zeros if needed).
