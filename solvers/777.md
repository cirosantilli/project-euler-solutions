# Project Euler 777 Solution - Lissajous Curves

<https://projecteuler.net/problem=777>:

* [777.py](777.py)

This solution avoids geometry-heavy enumeration by turning the problem into **number theory + exact summations**.

## 1) Closed form for `d(a,b)`

After a phase-shift of the parameter, the curve can be written as a standard Lissajous form:

- `x = cos(a t + aπ/10)`
- `y = cos(b t)`

Self-intersections come from pairs of parameter values producing the same `(x,y)`. For a generic phase, those coincidences are all **transverse crossings** (true self-intersections).  
For this specific phase `aπ/10`, non-generic behavior happens **exactly when `10 | ab`** (alignment with the phase denominator).

From the trigonometric intersection conditions (and a tangency test via derivatives), one gets:

- If `10 ∤ ab` (generic case):
  \[
  d(a,b)=\frac{4ab-3a-3b}{2}
  \]
- If `10 | ab` (non-generic alignment):
  \[
  d(a,b)=\frac{2ab-3a-3b+4}{4}
  \]

The implementation keeps everything exact by working with `4*d(a,b)` as an integer.

## 2) Summing over coprime pairs with Möbius inversion

We need:
\[
s(m)=\sum d(a,b) \quad \text{over } 2\le a,b\le m,\ \gcd(a,b)=1.
\]

For polynomial weights (like `ab`, `a`, and constants), coprimality is handled with the Möbius function:

\[
\sum_{\gcd(a,b)=1} F(a,b)=\sum_{d=1}^m \mu(d)\sum_{x,y\le \lfloor m/d\rfloor} F(dx,dy).
\]

So we compute three base sums over coprime pairs:

- \(\sum ab\)
- \(\sum a\) (and symmetry gives \(\sum b\))
- \(\sum 1\)

Each inner sum factorizes into simple arithmetic series.

## 3) Correcting the `10 | ab` subset with inclusion–exclusion

Only pairs with `10|ab` use the second `d(a,b)` formula.  
Inside the Möbius inversion step, the condition becomes:

- `2 | d²xy` and `5 | d²xy`

Since only primes `2` and `5` are involved, the “at least one even” and “at least one multiple of 5” constraints are counted by inclusion–exclusion using:

- counts/sums of **odd** numbers
- counts/sums of numbers **not divisible by 5**
- counts/sums of numbers that are **odd and not divisible by 5**

This yields exact formulas for:
- the number of `(x,y)` pairs satisfying the condition,
- \(\sum x\),
- \(\sum xy\).

## 4) Exact arithmetic and output formatting

All intermediate values are integers (often very large). The final result is a rational with denominator `4`.

The output must be:
- scientific notation,
- **10 significant digits**.

To avoid floating-point error, the code formats the rational using integer scaling and rounding.

## Complexity

- Möbius sieve: **O(m)**
- One pass summation over `d=1..m`: **O(m)** with small constant factors

Memory: `O(m)` for the Möbius array.

This is fast enough for `m = 10^6` in pure Python.
