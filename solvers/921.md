# Project Euler 921 Solution - Golden Recurrence

<https://projecteuler.net/problem=921>:

* [921.py](921.py)

## Key ideas used

### 1) Conjugating the recurrence to a power map
The given recurrence for `a_n` becomes simple after the Möbius transform

\[
 t_n = \frac{a_n - 1}{a_n + 1}.
\]

A direct algebraic check shows

\[
 t_{n+1} = t_n^5.
\]

So the “complicated” rational recurrence is just repeated fifth-powers in disguise.

### 2) Writing `a_n` using Fibonacci and Lucas numbers
From `t_{n+1}=t_n^5` and `a_n = (1+t_n)/(1-t_n)`, one can rewrite `a_n` as a ratio of powers of the golden ratio `φ`.
For these indices (always odd), Fibonacci and Lucas numbers satisfy

- \(F_n = (\phi^n + \phi^{-n})/\sqrt{5}\)
- \(L_n = \phi^n - \phi^{-n}\)

This lets `p_n` and `q_n` be expressed via Fibonacci/Lucas values at a specific index.

### 3) Working modulo a prime field
The required modulus is prime, so computations are done in \(\mathbb{F}_p\):

- Modular inverses use `pow(x, -1, p)`.
- `sqrt(5) mod p` is found once using **Tonelli–Shanks**.

### 4) Avoiding huge exponents with a Fibonacci-style exponent recurrence
The indices involve \(5^{F_i}\), which is astronomically large.
Instead of building `F_i`, we use:

\[
5^{F_i} = 5^{F_{i-1}+F_{i-2}} = 5^{F_{i-1}}\,5^{F_{i-2}}.
\]

So the sequence `E_i = 5^{F_i} (mod p-1)` is generated by a simple multiplicative Fibonacci recurrence.

### 5) Constant-time term evaluation
For each term, the code computes

- `u = (φ^3)^{E_i} (mod p)`
- `F_k` and `L_k` from `u` and `u^{-1}`
- `s(F_i) = (F_k^5 + L_k^5)/32 (mod p)`

and accumulates the sum.
