# Project Euler 397 Solution - Triangle on Parabola

<https://projecteuler.net/problem=397>:

* [397.py](397.py)

This repository contains a pure-Python solution (no third‑party libraries) for Project Euler **397**.

## Key ideas

### 1) A chord slope depends only on `x₁ + x₂`
Points lie on the parabola:

- `P(t) = (t, t²/k)`

For two points `t=u` and `t=v`, the chord slope is:

- `(v²/k - u²/k) / (v-u) = (u+v)/k`

So every segment between two lattice x-coordinates has a slope that depends only on the **sum** of the x-coordinates.

This reduces angle conditions between segments to equations in the sums:

- At `A`: `s = a+b`, `t = a+c`
- At `B`: `p = a+b`, `q = b+c`
- At `C`: `t = a+c`, `q = b+c`

### 2) 45° becomes a “tangent addition” identity
Using the dot-product condition for a 45° angle and substituting the slopes above, the 45° constraints simplify to:

- **Left/right vertex (A or C):**  
  `k(t-s) = k² + s·t`  (with `s < t`)

- **Middle vertex (B):**  
  `k(q-p) = -k² - p·q` (with `p < q`)

After dividing by `k²`, these match tangent addition/subtraction formulas:

- `tan(θ+45°) = (tanθ + 1)/(1 - tanθ)`
- `tan(θ-45°) = (tanθ - 1)/(1 + tanθ)`

That’s why the solutions can be parameterized cleanly.

### 3) Reducing to divisors of `2k²`
Both equations can be rearranged to show that certain linear combinations must divide `2k²`. Concretely, for each `k`:

- Let `D = 2k²`
- Every valid 45° configuration corresponds to choosing a **positive divisor** `d | D`

Then the needed sums become simple integer expressions:

- **Angle at A (leftmost):**  
  `t = d - k` and `s = k - D/d`

- **Angle at B (middle):**  
  `q = k + d` and `p = -(k + D/d)`

So for each `k`, we enumerate divisors of `2k²` and convert them into `(s,t)` or `(p,q)`.

### 4) Counting triangles becomes counting integer points in intervals
Once the sums are fixed, the remaining free coordinate is just one integer (`a` for the left vertex, `b` for the middle vertex). The bounds:

- `-X ≤ a,b,c ≤ X` and `a<b<c`

become a short intersection of integer intervals, so the number of valid choices is:

- `max(0, U-L+1)`

This is **O(1)** per divisor.

### 5) Inclusion–exclusion for “at least one angle”
If we sum counts for angles at `A`, `B`, and `C`, triangles with **two** 45° angles (i.e., 45‑45‑90 triangles) get double-counted.

We compute:
- `count_A` (angle at left vertex), and use symmetry for `count_C`
- `count_B` (angle at middle vertex)
- `overlap_AB` (angles at A and B are 45 → C is 90)
- `overlap_AC` (angles at A and C are 45 → B is 90)

Final formula:

- `F = 2*count_A + count_B - 2*overlap_AB - overlap_AC`

## Files

- `main.py` — computes `F(1_000_000, 1_000_000_000)` and includes asserts for the sample values.
