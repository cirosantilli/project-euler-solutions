# Project Euler 904 Solution - Pythagorean Angle

<https://projecteuler.net/problem=904>:

* [904.py](904.py)

This program computes

\[
F(N,L)=\sum_{n=1}^{N} f(\sqrt[3]{n},L)
\]

where `f(α, L)` selects an integer right triangle with hypotenuse `≤ L` whose **median angle** `θ`
(the smaller angle between the medians to the two legs) is closest to `α` (degrees). If several
triangles have the same minimum deviation, the one with the **largest area** is chosen.

The implementation avoids brute-force enumeration of all right triangles up to `L=10^{10}`.

## Main ideas

### 1) A direct expression for the median angle

For a right triangle with legs `a,b`, the tangent of the median angle `θ` satisfies:

\[
\tan(\theta)=\frac{3ab}{2(a^2+b^2)}.
\]

This means we can evaluate `θ` using only integer arithmetic plus one `atan`.

### 2) Euclid parameterization + a one-variable function

Every integer right triangle is a scale multiple of a Euclid triple:

\[
(a,b,c)=k\,(m^2-n^2,\;2mn,\;m^2+n^2),\quad m>n>0.
\]

Scaling by `k` does not change `θ`. Therefore, for any primitive shape with hypotenuse `c₀`,
the best (largest-area) representative under `c ≤ L` is obtained by taking
`k = ⌊L / c₀⌋`.

Using `t = n/m`, the median-angle tangent becomes a one-variable function

\[
g(t)=\tan(\theta)=\frac{3t(1-t^2)}{(1+t^2)^2}.
\]

It increases on `[0, \sqrt2-1]` and decreases on `[\sqrt2-1, 1]`, so each target value in-range
has two real solutions.

### 3) Two real target ratios via binary search

For each `α`, compute `y = tan(α)`. Then find `t₁` and `t₂` solving `g(t)=y` on the increasing and
decreasing branches using binary search. The optimal rational `n/m` must lie very close to one of
these real roots.

### 4) Continued fractions with the *circle* constraint

The hypotenuse of the primitive Euclid triple is `m^2 + n^2`, so the constraint is

\[
m^2+n^2 \le L.
\]

For each real root `t`, we approximate it by rationals `n/m` using continued fractions, but we stop
when the next convergent would violate `n^2+m^2 ≤ L`. At that final step, the best admissible
fractions are among the **semiconvergents** between the last two convergents. Their numerator and
denominator are linear in an integer parameter `k`, so the circle constraint becomes a quadratic
inequality, letting us jump straight to the largest feasible `k` (and check a tiny neighborhood).

This yields only a small handful of candidates per `α`.

### 5) Exact tie-breaking by maximum area

For each candidate primitive shape `(a,b,c)`, we scale it by `k = ⌊L/c⌋`. If multiple candidates
achieve the same minimum `|θ-α|`, we compare their scaled areas, which are proportional to
`k^2 * a * b`.

## Verification

The code includes asserts for the sample values from the statement:

- `f(30, 10^2) = 198`
- `f(10, 10^6) = 1600158`
- `F(10, 10^6) = 16684370`
