# Project Euler 856 Solution - Waiting for a Pair

<https://projecteuler.net/problem=856>:

* [856.py](856.py)

This solution computes the **expected number of cards drawn** from a standard 52‑card deck until **two consecutive cards share the same rank**, or until all 52 cards are drawn.

## Key ideas

### 1) State compression by symmetry
Only the **rank** of cards matters (suits are irrelevant except for multiplicity). Every rank starts with 4 copies.

While drawing without replacement, the process (conditioned on *no consecutive pair yet*) depends on:

- how many ranks have **0,1,2,3,4** cards remaining, and
- how many cards remain of the **most recently drawn rank** (because drawing that rank next would end the process).

So a state is represented as:

- `(a0, a1, a2, a3, a4, c)`
  - `aj` = number of ranks with `j` remaining cards
  - `c` = remaining cards of the last drawn rank

This collapses an enormous “which exact ranks” space into a small number of histogram states.

### 2) Markov-style dynamic programming over draws
Let the deck have `R` remaining cards.

From a state `(a0..a4, c)`, the next card must come from a **different rank** to stay in the “no consecutive pair” process.
For each `r ∈ {1,2,3,4}`:

- eligible ranks with `r` remaining cards are `a_r` (minus 1 if the last rank also has `r` remaining)
- choosing any of those ranks has probability `eligible * r / R`
- after drawing it, that rank moves from bucket `r` to `r-1`, and the new `c` becomes `r-1`

We propagate probabilities forward for 51 steps to obtain:

- `S[i] = P(no consecutive pair in the first i draws)`

### 3) Tail-sum formula for the expectation
For an integer-valued stopping time `N` (number of cards drawn),

- `E[N] = Σ_{t≥1} P(N ≥ t)`

Here, `P(N ≥ t)` for `t ≥ 3` is exactly `S[t-1]`.
This yields:

- `E[N] = 1 + Σ_{i=1}^{51} S[i]`

### 4) Exact arithmetic and final rounding
All probabilities are accumulated as exact rational numbers using Python’s standard-library `Fraction`.
The final expectation is converted to `Decimal` and rounded to **8 digits after the decimal point**.

## Running

```bash
python3 main.py
```

The program prints the required rounded value.
