# Project Euler 528 Solution - Constrained Sums

<https://projecteuler.net/problem=528>:

* [528.py](528.py)

This solution counts the number of bounded integer tuples:

- `x1 + x2 + ... + xk ≤ n`
- `0 ≤ xm ≤ b^m` for `m = 1..k`

and computes:

\[
\left(\sum_{k=10}^{15} S(10^k, k, k)\right)\bmod 1{,}000{,}000{,}007.
\]

## Main techniques

### 1) Inclusion–exclusion over upper bounds

Without upper bounds, the number of nonnegative integer solutions to:

\[
x_1+\cdots+x_k \le n
\]

is the standard stars-and-bars count:

\[
\binom{n+k}{k}.
\]

To enforce `xm ≤ um` where `um = b^m`, use inclusion–exclusion:

- For a subset `A` of variables forced to violate bounds (`xm ≥ um+1`),
  substitute `x'm = xm - (um+1) ≥ 0`.
- This reduces the budget by \(\sum_{m\in A}(u_m+1)\).
- The number of solutions for that subset is:

\[
\binom{n - \sum_{m\in A}(u_m+1) + k}{k}
\]

(only if the budget remains nonnegative).

Summing with alternating signs over all subsets yields `S(n,k,b)`.

Because `k ≤ 15`, iterating all `2^k` subsets is tiny (at most 32768).

### 2) Binomial modulo a prime with huge `n` but tiny `k`

The modulus \(p = 1{,}000{,}000{,}007\) is prime and `k ≤ 15 < p`.

So we compute:

\[
\binom{N}{k} = \frac{N(N-1)\cdots(N-k+1)}{k!} \pmod p
\]

by:
- multiplying the `k` falling-factorial terms modulo `p`,
- multiplying by the modular inverse of `k!` (via Fermat’s little theorem).

No Lucas theorem is needed because `k` is far smaller than `p`, and `k!` is invertible.

### 3) Fast subset sums

For each `k`, we precompute subset sums of the weights `wm = (b^m + 1)` using:

\[
\text{sum}[mask] = \text{sum}[mask \setminus \text{lsb}] + w[\text{lsb index}]
\]

so each subset’s budget is looked up in `O(1)`.

## Complexity

For each `(n,k,b)`:

- Subsets: `2^k`
- Work per subset: `O(k)` for the falling factorial (here `k ≤ 15`)

So the total is about `O(k · 2^k)` which is easily fast for `k ≤ 15`.

## Files

- `main.py` — implementation + the required asserts from the statement
- Run: `python3 main.py` (prints the final answer)
