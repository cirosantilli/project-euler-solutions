# Project Euler 392 Solution - Enmeshed Unit Circle

<https://projecteuler.net/problem=392>:

* [392.py](392.py)

## Goal

Choose the positions of `N` inner vertical and `N` inner horizontal grid lines inside the fixed square
`[-1,1] × [-1,1]` to **minimize the total area of grid cells that overlap the unit circle**.

The example given in the problem statement is:

- `N = 10` → minimal area `3.3469640797` (rounded to 10 decimals)

The task is to compute the minimal area for `N = 400`, also rounded to 10 decimals.

(Problem statement: Project Euler 392 “Enmeshed Unit Circle”.)

## Key Techniques Used

### 1) Symmetry + “axis splitting” to reduce to a quadrant

The circle and the outer box are symmetric about both axes, so there is an optimal symmetric solution.

Even if the grid does **not** contain the axes as grid lines (when `N` is even), we can conceptually
split every rectangle by the axes `x=0` and `y=0`.  
If a rectangle crosses an axis, it is automatically red (it contains a point on the axis that lies inside the unit circle), so splitting it does **not** change the total red area.

This lets us compute the total as:

- **Total red area = 4 × (red area in the first quadrant [0,1]²)**

In the first quadrant, a cell is red iff its **lower-left corner** `(x_i, y_j)` satisfies:

- `x_i² + y_j² ≤ 1`

### 2) The optimal boundary is a staircase touching the circle at every corner

In the first quadrant, the set of red cells is “downward closed” (if a cell is red, everything below/left is red).
So the union of red cells is bounded by a monotone **staircase** from `(0,1)` to `(1,0)`.

At the optimum:

- the staircase uses **every** available x-interval and y-level (no wasted lines),
- and each staircase “corner” lies **on** the circle.

This turns the 2D placement problem into a 1D problem: pick x-breakpoints `0=x₀<x₁<…<x_m=1` for
`m = ⌊N/2⌋ + 1` intervals.

### 3) Reduce to minimizing a (variable-step) left Riemann sum

Let `f(x) = √(1 − x²)` be the quarter-circle boundary.

With the optimal staircase structure, the quadrant’s red area becomes:

\[
S = \sum_{i=0}^{m-1} (x_{i+1}-x_i)\, f(x_i)
\]

That is exactly a **left Riemann sum** of `f` with variable interval widths.  
Minimizing the red area becomes minimizing `S` over the interior `x_i`.

### 4) Euler–Lagrange / stationarity gives a recurrence (shooting method)

Setting the derivative of `S` with respect to each interior `x_k` to zero yields:

\[
f(x_{k-1}) - f(x_k) + (x_{k+1}-x_k)\,f'(x_k) = 0
\]

For `f(x)=√(1−x²)` (so `f'(x)=−x/f(x)`), this simplifies to a **forward recurrence**:

\[
x_{k+1} = x_k + \frac{(f(x_{k-1}) - f(x_k))\,f(x_k)}{x_k}
\]

So if you pick a starting value `x₁`, the recurrence generates `x₂, x₃, …, x_m`.

We then use **bisection** on `x₁` so that the generated sequence lands exactly at the boundary condition:

- `x_m = 1`

Once we have the `x_i`, we compute `S` and output `4S`.

## Complexity

- Generating the grid: `O(m)` operations (`m = ⌊N/2⌋ + 1`)
- Bisection iterations: fixed (~200)

For `N = 400`, `m = 201`, so this runs essentially instantly in Python.
