# Project Euler 702 Solution - Jumping Flea

<https://projecteuler.net/problem=702>:

* [702.py](702.py)

This repository contains a fast single-threaded Python solution for computing `S(N)`.

## Key ideas

### 1) Reachable points after `d` jumps are dyadic rationals
Each jump moves the flea to the midpoint between its current position and a corner, so after `d` jumps every reachable point has coordinates with denominator `2^d` in a suitable basis. This turns the geometric reachability question into counting how many small unit triangles contain at least one such point.

### 2) Classify triangles via modular arithmetic
For a fixed `d`, consider the residues

```
a*N mod 2^d     for a = 1..2^d-1
```

When `N` is odd, multiplication by `N` permutes the non-zero residues modulo `2^d`.
The relative order of two residues determines which “orientation class” (think: two colors) the corresponding unit triangle belongs to. Therefore, counting colored triangles reduces to counting inversions of that permutation.

### 3) Inversion counting without building the permutation
Let `f(x, m)` be the number of inversions in the sequence

```
a*x mod m   (a = 1..m-1)
```

with `gcd(x, m) = 1`. Instead of generating `m-1` values, `f` can be computed using a recursion that mirrors the Euclidean algorithm. Writing

```
m = t*x + y,   0 < y < x
```

one can express `f(x, m)` as a combination of:
- a closed-form contribution from complete blocks, and
- smaller inversion counts `f(x, y)` and `f(x, x-y)`.

This makes each `f(x, m)` take about `O(log m)` time.

### 4) Final summation over powers of two
Define

```
g(x, m) = (m-1)(m-2) - f(x, m)
```

and let `D = bit_length(N) = floor(log2 N) + 1`.
The geometry-to-arithmetic reduction yields:

```
S(N) = N(3N+1)/2 * (D+1)
       - sum_{d=2..D} g(N, 2^d)
       + 2 * g(N, 2^D - N)
```

The script evaluates this sum directly.

## Complexity

For the target input (`N = 123456789`, so `D = 27`) the code computes a few dozen `g(·,·)` values.
Each uses a short Euclidean recursion, so runtime is tiny and memory usage is `O(1)` aside from a small memo table.

## How to run

```bash
python3 main.py
```

Optional: pass a custom odd `N`:

```bash
python3 main.py 12345
```

The script includes assertions for the sample values from the problem statement.
