# Project Euler 814 Solution - Mezzo-forte

<https://projecteuler.net/problem=814>:

* [814.py](814.py)

## Key observation: “screams” are exactly 2-cycles
Each person chooses one of three targets: left, right, or diametrically opposite.  
A person screams **iff** they are in a *mutual-looking pair* (both look at each other), which is a directed 2-cycle.

So “exactly half of the people scream” (out of `4n`) means:
- exactly `2n` screamers
- equivalently **exactly `n` mutual pairs**

No other structure (longer cycles, trees into cycles, etc.) produces screams.

---

## Geometry → a 2×(2n) “twisted ladder”
Label the `4n` people around the circle. Pair diametrically opposite people; this creates `2n` opposite pairs.

Arrange these opposite pairs as columns:
- each column has a **top** and **bottom** person (opposite each other)
- horizontal adjacency follows the circle order

The circle wrap-around swaps rows (top connects to bottom, bottom connects to top), producing a *twist*.  
This reduces the problem to counting assignments on a width-2 strip with a cyclic (twisted) boundary.

---

## State compression and transfer DP
Process columns left→right.

**State**: a 2-bit mask describing whether each person in the current column has an *incoming right-look* from the previous column:
- bit 0: incoming to top
- bit 1: incoming to bottom

Why this works:
- A horizontal mutual pair is counted when the right endpoint chooses **Left** and it has an incoming **Right** from its left neighbor.
- A vertical mutual pair happens exactly when **both** choose **Opposite** in the same column.

We build a polynomial DP where the exponent tracks how many mutual pairs have been formed so far.  
Only the coefficient of `x^n` is needed, so degrees `> n` are truncated.

The final column uses a swapped-row transition to model the twist, and we enforce cyclic consistency by summing over all possible starting masks and requiring the ending mask to match.

---

## Complexity
- Columns: `2n`
- Polynomial degree: `n`
- States: 4

Overall time is `O(n^2)` with small constants, and memory is `O(n)` per state.  
This is sufficient for `n = 1000` (the problem asks for `S(10^3)` modulo `998244353`).
