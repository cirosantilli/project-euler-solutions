# Project Euler 58 Solution - Spiral Primes

<https://projecteuler.net/problem=58>:

* [58.py](58.py)
* [58.lean](58.lean)

In the square spiral of odd side length `s`, the only new diagonal values introduced when expanding from side `s-2` to `s` are the four corner values:

- `s²`
- `s² - (s-1)`
- `s² - 2(s-1)`
- `s² - 3(s-1)`

For `s > 1`, `s²` is an odd square and therefore not prime, so only the other three corners need primality testing.

We maintain:
- `total_diag`: total count of numbers on both diagonals (`1`, then `+4` per layer)
- `prime_count`: number of primes on both diagonals (`+0..3` per layer)

After each layer, the ratio is `prime_count / total_diag`. We need the first side length where this ratio falls below `10%`, which can be checked exactly using integers:
`prime_count * 10 < total_diag`.

Primality testing is done with a fast deterministic Miller–Rabin test (safe for 64-bit integers), which is more than sufficient since the maximum values here are about `(26241)² ≈ 6.9e8`.
