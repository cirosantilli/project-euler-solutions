# Project Euler 449 Solution - Chocolate Covered Candy

<https://projecteuler.net/problem=449>:

* [449.py](449.py)

This problem asks for the **volume of a uniform 1 mm chocolate coat** around an ellipsoid of revolution:

\[
b^2x^2+b^2y^2+a^2z^2=a^2b^2
\quad\Longrightarrow\quad
\frac{x^2}{a^2}+\frac{y^2}{a^2}+\frac{z^2}{b^2}=1
\]

So the semi-axes are **(a, a, b)**: equatorial radius `a` and polar radius `b`.

## Key idea 1: Use the parallel-body (Steiner) volume formula

A uniform coat of thickness `t` is the **outer parallel body** (Minkowski sum with a radius-`t` ball).

For any smooth convex body in 3D:

\[
V(t)=V_0 + S\,t + M\,t^2 + \frac{4}{3}\pi t^3
\]

- `S` is the surface area.
- `M = \int H\,dA`, where \(H=(\kappa_1+\kappa_2)/2\) is the **average mean curvature**.
- \(\frac{4}{3}\pi t^3\) is the volume contribution of the rounding ball.

Therefore the chocolate volume is simply:

\[
V_{\text{choc}}(t)=V(t)-V_0 = S\,t + M\,t^2 + \frac{4}{3}\pi t^3
\]

For this problem, `t = 1`.

## Key idea 2: Closed forms for a spheroid’s `S` and `M`

Because the ellipsoid is a **surface of revolution** (a spheroid), both `S` and `M` have elementary closed forms.

Let:

- `A` = equatorial radius
- `C` = polar radius

### Surface area

- **Oblate** (`A > C`), with \(e=\sqrt{1-\frac{C^2}{A^2}}\):

\[
S = 2\pi A^2\left(1+\frac{1-e^2}{e}\operatorname{artanh}(e)\right)
\]

- **Prolate** (`C > A`), with \(e=\sqrt{1-\frac{A^2}{C^2}}\):

\[
S = 2\pi A^2\left(1+\frac{C}{Ae}\arcsin(e)\right)
\]

### Integrated mean curvature

Using principal curvatures of a surface of revolution and integrating around the generating curve gives:

- **Oblate** (`A > C`):

\[
M = 2\pi C + \frac{2\pi A}{e}\arctan\!\left(\frac{Ae}{C}\right)
\]

- **Prolate** (`C > A`):

\[
M = 2\pi C + \frac{2\pi A^2}{Ce}\operatorname{artanh}(e)
\]

## Key idea 3: Numerical stability near a sphere

At `a ≈ b`, the eccentricity `e → 0` and expressions like `atanh(e)/e` and `asin(e)/e` should be handled carefully.

The implementation uses:
- a direct sphere special-case, and
- tiny-`e` series expansions for `atanh(e)/e` and `asin(e)/e`.

## Tests

The code includes `assert`s for the problem statement’s check values:

- `(a,b)=(1,1)` gives \(\frac{28}{3}\pi\)
- `(a,b)=(2,1)` gives approximately `60.35475635`

## Output

The program prints the required answer for `(a,b)=(3,1)` rounded to **8 decimal places**.
