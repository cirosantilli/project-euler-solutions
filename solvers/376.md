# Project Euler 376 Solution - Nontransitive Sets of Dice

<https://projecteuler.net/problem=376>:

* [376.py](376.py)

This solution counts nontransitive triples of **six-sided** dice whose face values are integers in **[1..N]**.

A (cyclic) set `{A,B,C}` is counted when:

- `B` beats `A` with probability `> 1/2`
- `C` beats `B` with probability `> 1/2`
- `A` beats `C` with probability `> 1/2`

and `{A,B,C}`, `{B,C,A}`, `{C,A,B}` are considered the same (rotation of the cycle).

The program asserts the example `N = 7 -> 9780` and prints the answer for `N = 30`.

## Main techniques used

### 1) Count by *distinct* pip values
Across three dice there are only `18` faces total, so at most **18 distinct pip values** can appear.

Instead of iterating over all `N` pip values (where most are unused), we count configurations that use **exactly `k` distinct values** (with `k ≤ 18`) and then choose which `k` actual values from `[1..N]` are used:

\[
\text{ordered}(N) = \sum_{k=1}^{18} \text{count}_k \cdot \binom{N}{k}
\]

### 2) Incremental win counting while scanning values in increasing order
Represent each die by how many faces show the current pip value.

If we process distinct pip values from low to high, then when we assign `db` faces of die `B` to the current value, those faces beat **all earlier faces of `A`**. So wins update incrementally:

- `wins(B>A) += db * (A faces seen so far)`
- `wins(C>B) += dc * (B faces seen so far)`
- `wins(A>C) += da * (C faces seen so far)`

A die beats another iff `wins > 18` out of 36 comparisons.

### 3) State compression + capping
We only care whether each win count is greater than `18`, so each win counter is **capped at 19** (`19` means “already winning”).

DP state:
- `(a_used, b_used, c_used)` in `0..6`
- `(wBA, wCB, wAC)` in `0..19`

This is at most `7^3 * 20^3 ≈ 2.7M` states, but we keep it sparse via an active-state list.

### 4) Directed cycle counting and dividing by 3
We count **ordered** cycles `(A,B,C)` with:
`B>A`, `C>B`, `A>C`.

Each cyclic set has 3 rotations, so the final answer is `ordered / 3`.

## Files

- `main.py` — computes and prints the answer, with an `assert` for `N=7`.
