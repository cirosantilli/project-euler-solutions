# Project Euler 875 Solution - Quadruple Congruence

<https://projecteuler.net/problem=875>:

* [875.py](875.py)

This repository contains a standalone Python solution (no external libraries) for Project Euler 875.

## Key ideas

### 1) Rewrite the count using additive characters

Let

\[
q(n) = \#\{(\mathbf a,\mathbf b) \in (\mathbb Z/n\mathbb Z)^4 \times (\mathbb Z/n\mathbb Z)^4 : \sum_{i=1}^4 a_i^2 \equiv \sum_{i=1}^4 b_i^2 \pmod n\}.
\]

Use the orthogonality of additive characters:

\[
\mathbf 1_{x\equiv 0\,(\bmod n)} = \frac1n \sum_{t=0}^{n-1} e^{2\pi i t x / n}.
\]

Applying this to \(x = \sum a_i^2 - \sum b_i^2\) factorises the sum over the 8 variables, giving

\[
q(n) = \frac1n \sum_{t=0}^{n-1} \left| \sum_{x=0}^{n-1} e^{2\pi i t x^2 / n} \right|^8.
\]

The inner sum is a quadratic Gauss sum.

### 2) Reduce to prime powers (multiplicativity)

The congruence modulo \(n\) splits over coprime factors by the Chinese Remainder Theorem, so \(q(n)\) is **multiplicative**:

\[
\gcd(a,b)=1 \implies q(ab)=q(a)q(b).
\]

So it suffices to compute \(q(p^k)\) for prime powers and then build \(q(n)\) from the prime factorisation of \(n\).

### 3) Classify Gauss-sum magnitudes for \(p^k\)

For odd primes \(p\), the magnitude of \(\sum_x e^{2\pi i t x^2/p^k}\) depends only on \(v_p(t)\) (the exponent of \(p\) dividing \(t\)).
This yields a closed form that can be written without any division by using a geometric series:

\[
q(p^k)=p^{7k} + (p-1)p^{4k-1}\sum_{j=0}^{k-1} p^{3j}.
\]

For \(p=2\), a similar valuation split holds, except that one valuation class contributes zero.
This leads to

- \(q(2)=128\)
- for \(k\ge 2\):

\[
q(2^k)=2^{7k} + 2^{4k+3}\sum_{j=0}^{k-2} 2^{3j}.
\]

Because the formulas are sums and products of integer powers, we can compute them **directly modulo** the required modulus, without any modular inverses.

### 4) Fast summation up to \(N\)

To compute

\[
Q(N)=\sum_{n=1}^N q(n),
\]

the code uses:

- a **linear sieve** to build the smallest prime factor array up to \(N\),
- a dynamic programming pass over \(n=2\ldots N\) that splits \(n\) into
  \(n = p^k \cdot m\) with \(\gcd(p,m)=1\),
  then uses multiplicativity:

\[
q(n)=q(p^k)\,q(m).
\]

This yields an overall runtime roughly linear in \(N\), suitable for \(N=12{,}345{,}678\).

## Verification

The implementation includes assertions for the sample values given in the problem statement:

- \(q(4)=18432\)
- \(Q(10)=18573381\)
