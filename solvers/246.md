# Project Euler 246 Solution - Tangents to an Ellipse

<https://projecteuler.net/problem=246>:

* [246.py](246.py)

This solution turns the geometry problem into two **lattice-point counting** problems using only **integer arithmetic**.

## 1) Converting the “circle + point” definition into a standard ellipse

For a point \(X\), the distance to the circle (center \(M\), radius \(r\)) is
\(\lvert r - d(X,M)\rvert\). Because \(G\) lies **inside** the circle, the relevant branch is

\[
d(X,G) = r - d(X,M) \quad\Longleftrightarrow\quad d(X,G) + d(X,M) = r.
\]

So the curve is the usual ellipse with foci \(M\) and \(G\), and constant sum of distances \(r\).
With the origin shifted to the midpoint of the foci (an **integer** translation, so lattice points stay lattice points), the ellipse becomes

\[
\frac{x^2}{a^2} + \frac{y^2}{b^2} = 1,
\]

with \(a = r/2\) and \(b^2 = a^2 - c^2\) where \(c\) is the focal distance.

## 2) Tangents from an external point and the angle condition

From an external lattice point \(P=(x_0,y_0)\), the tangent lines to
\(x^2/a^2 + y^2/b^2 = 1\) have slopes that are the roots of a quadratic.
From that quadratic, the **discriminant** gives a clean expression for the angle between tangents.

Let \(u=x_0^2\) and \(v=y_0^2\). Then the acute angle \(\varphi\) between the two tangent lines satisfies

\[
\lvert\tan\varphi\rvert > 1
\quad\Longleftrightarrow\quad
4\,(b^2u + a^2v - a^2b^2) > (u+v-(a^2+b^2))^2.
\]

This inequality depends only on \(x_0^2\) and \(y_0^2\), so the region is symmetric in all quadrants.

## 3) Director circle split (key simplification)

For an axis-aligned ellipse, the locus of points from which the two tangents are **perpendicular** is the
**director circle**:

\[
x^2 + y^2 = a^2 + b^2.
\]

* Inside this circle, the actual geometric angle \(\angle RPS\) (the angle that contains the ellipse) is **obtuse** (> 90°),
  hence automatically > 45°.
* Outside this circle, \(\angle RPS\) is **acute**, and the condition \(\angle RPS > 45°\) is equivalent to
  \(\lvert\tan\varphi\rvert>1\) (the inequality above).

So we count two disjoint sets:

1. **Annulus count**: points outside the ellipse but *inside* the director circle.
2. **Outer count**: points outside the director circle satisfying the tangent-angle inequality.

## 4) Efficient counting by scanning \(y\) and solving a quadratic in \(x^2\)

For a fixed integer \(y\), write \(v=y^2\). The angle inequality becomes a quadratic in \(u=x^2\):

\[
u^2 + p(v)\,u + q(v) < 0.
\]

That means all valid \(u\) lie between two real roots. We:

* compute the discriminant and its integer square root (`math.isqrt`),
* get a tight integer bracket for the roots,
* convert the resulting \(u\)-interval into an \(x\)-interval,
* apply the extra constraint \(x^2+y^2 > a^2+b^2\) for the “outer” region,
* and use symmetry to multiply counts for \(\pm x\) and \(\pm y\).

This runs in well under a second in Python.

## Result

The program prints the required number of lattice points \(P\) with \(\angle RPS > 45°\).
