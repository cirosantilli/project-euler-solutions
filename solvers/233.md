# Project Euler 233 Solution - Lattice Points on a Circle

<https://projecteuler.net/problem=233>:

* [233.py](233.py)

## Key reduction: geometry → sum of two squares

The circle through the square vertices:

- \((0,0)\), \((N,0)\), \((0,N)\), \((N,N)\)

is the circumcircle of the square. Its center is \((N/2, N/2)\) and its radius is \(N/\sqrt{2}\), so integer points \((x,y)\) on that circle satisfy:

\[
(x-\tfrac N2)^2 + (y-\tfrac N2)^2 = \tfrac{N^2}{2}.
\]

Multiply by 4 and set \(u = 2x-N\), \(v = 2y-N\):

\[
u^2 + v^2 = 2N^2.
\]

Because \(u\) and \(v\) always have the same parity, the linear change of variables

\[
A=\frac{u+v}{2},\quad B=\frac{u-v}{2}
\]

is integral and yields:

\[
A^2 + B^2 = N^2.
\]

So the original count is exactly the number of integer representations of \(N^2\) as a sum of two squares:

\[
f(N) = r_2(N^2).
\]

## Number theory: formula for \(r_2(n)\)

If

\[
n = 2^a \prod p_i^{\alpha_i}\prod q_j^{\beta_j}
\]

where \(p_i \equiv 1 \pmod 4\) and \(q_j \equiv 3 \pmod 4\), then the classical theorem gives:

- \(r_2(n)=0\) if any \(\beta_j\) is odd.
- Otherwise:

\[
r_2(n) = 4\prod (\alpha_i+1).
\]

For \(n = N^2\), all exponents are even, so the \(q_j\) condition is automatically satisfied. If

\[
N=\cdots \prod p_i^{e_i}\quad (p_i\equiv 1 \!\!\!\pmod 4),
\]

then \(N^2\) has exponents \(2e_i\), and:

\[
f(N)=r_2(N^2) = 4 \prod (2e_i+1).
\]

## Forcing \(f(N)=420\)

We need:

\[
4\prod (2e_i+1)=420 \quad\Rightarrow\quad \prod (2e_i+1)=105=3\cdot5\cdot7.
\]

Each factor \(2e_i+1\) is an odd integer \(\ge 3\). The only exponent patterns that can fit under \(N \le 10^{11}\) are:

- \((e_i)=(3,2,1)\) because \(7\cdot5\cdot3=105\)
- \((e_i)=(10,2)\) because \(21\cdot5=105\)
- \((e_i)=(7,3)\) because \(15\cdot7=105\)

(Other factorizations would force an exponent so large that even \(5^{\text{that exponent}}\) exceeds \(10^{11}\).)

## Handling “free” multipliers

Primes \(2\) and primes \(\equiv 3 \pmod 4\) do **not** appear in the product \(\prod (2e_i+1)\), so you can multiply a valid “base” by any integer \(t\) whose prime factors are only from:

- \(\{2\}\) and primes \(\equiv 3 \pmod 4\)

without changing \(f(N)\).

For each base \(B\), all numbers \(N=B\cdot t\) with \(t \le \lfloor 10^{11}/B\rfloor\) are valid, and contribute:

\[
\sum_{t} (B\cdot t) = B\cdot \sum_{t \le M} t.
\]

### Prefix sum sieve for allowed multipliers

Let:

\[
G(M)=\sum_{1 \le t \le M,\ t\ \text{has no prime factor } \equiv 1 \!\!\!\pmod 4} t.
\]

The largest \(M\) we ever need is small (about \(2.8\times 10^5\)), so we can compute \(G(M)\) for all \(M\) up to that maximum by a sieve that marks every multiple of every prime \(\equiv 1 \pmod 4\) as “forbidden”, then builds a prefix sum.

## Enumeration

We enumerate all possible bases of the three exponent patterns using primes \(\equiv 1 \pmod 4\), and for each base \(B\) add:

\[
B \cdot G\!\left(\left\lfloor \frac{10^{11}}{B}\right\rfloor\right).
\]

The code also includes the problem’s given check:

- `assert f(10000) == 36`

## Result

Running `main.py` prints the required sum:

- **271204031455541309**
