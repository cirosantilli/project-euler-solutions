# Project Euler 746 Solution - A Messy Dinner

<https://projecteuler.net/problem=746>:

* [746.py](746.py)

This solution counts the number of seatings of `n` families around a **labelled** circular table with `4n` seats, where men and women alternate, and **no family occupies four consecutive seats**.

The program computes:

- `M(n)`: valid seatings count
- `S(n) = Σ_{k=2..n} M(k)` modulo `1_000_000_007`

## Key techniques

### 1) Split by the two alternating gender patterns
Around a labelled circle there are exactly **two** ways to alternate genders:

- even seats male / odd seats female
- even seats female / odd seats male

Both patterns contribute equally, so we count one pattern and multiply by `2`.

### 2) Inclusion–exclusion over “a given family sits together”
Let `A_i` be the event “family `i` occupies four consecutive seats”.
Then:

`M'(n) = Σ_{k=0..n} (-1)^k * (number of seatings where k specific families are together)`

and `M(n) = 2 * M'(n)` for the two gender patterns.

For a fixed set of `k` families, we:

- choose `k` disjoint blocks of **4 consecutive seats** on the circle
- place each family inside its block (`2!` ways for the two men and `2!` ways for the two women → `4` ways per family)
- permute the remaining men among remaining male seats and remaining women among remaining female seats

This gives a factor:

- `4^k * (2n-2k)! * (2n-2k)!`

### 3) Counting disjoint length-4 intervals on a cycle
The remaining combinatorics is:

> How many ways to place `k` **identical** length-4 intervals on a cycle of length `4n` so that they don’t overlap?

If we list the `k` intervals in cyclic order, the gap between consecutive interval starts must be at least `4`.
Let the extra gaps be `x_1..x_k ≥ 0` with:

`x_1 + ... + x_k = 4n - 4k`

The number of solutions is `C((4n-4k) + k - 1, k - 1) = C(4n - 3k - 1, k - 1)`.

For each gap-solution, choosing the start position of the first interval gives `4n` placements, but each final set is counted `k` times (any interval could be considered “first”), so:

`D(n,k) = (4n / k) * C(4n - 3k - 1, k - 1)`  for `k ≥ 1`,
and `D(n,0) = 1`.

### 4) Modular arithmetic with factorial tables
All computations are modulo `1_000_000_007` (prime), using:

- factorials and inverse factorials up to `4 * 2021`
- modular inverses for `1..2021`
- fast exponentiation for `4^k`

This makes each `M(n)` computation `O(n)`, and the full sum up to `2021` is fast.

## Running

```bash
python3 main.py
