# Project Euler 586 Solution - Binary Quadratic Form

<https://projecteuler.net/problem=586>:

* [586.py](586.py)

We count integers \(k \le n\) that can be written in **exactly** \(r\) ways as:

\[
k = a^2 + 3ab + b^2 \quad \text{with integers } a>b>0.
\]

The task is to compute \(f(10^{15}, 40)\), with checks:

- \(f(10^5,4)=237\)
- \(f(10^8,6)=59517\)

(These are asserted in `main.py`.)

---

## Key techniques used

### 1) Interpret the form as a norm (discriminant 5)

The quadratic form

\[
a^2 + 3ab + b^2
\]

is the norm form of the quadratic order generated by a root of
\(x^2 - 3x + 1 = 0\), which has discriminant \(5\).
That connects representations by this form to **prime splitting in \(\mathbb{Q}(\sqrt{5})\)**.

### 2) Prime splitting classification mod 5

For odd primes \(p\neq 5\):

- \(p \equiv 1,4 \pmod 5\) **splits**
- \(p \equiv 2,3 \pmod 5\) is **inert**
- \(p=5\) is **ramified**

This yields a clean rule for when representations exist:

- If any inert prime \(p \equiv 2,3 \pmod 5\) has an **odd** exponent in \(k\), then \(k\) has **0** representations.
- Powers of \(5\) do **not** change the representation count.

### 3) Representation count from exponents of split primes

Write the factorisation of \(k\) (ignoring any power of 5) and look only at split primes:

\[
k = \prod_{p \equiv 1,4 (5)} p^{e_p} \cdot (\text{inert primes})^{\text{even exponents}}.
\]

Define:

\[
d = \prod_{p \equiv 1,4 (5)} (e_p+1).
\]

Then the number of valid representations with \(a>b>0\) is:

\[
g(k) = \left\lfloor \frac{d}{2} \right\rfloor.
\]

So \(g(k)=r\) happens exactly when:

\[
d \in \{2r,\, 2r+1\}.
\]

This reduces the problem to counting factorizations where the product of \((e+1)\) equals a small integer.

### 4) Separate the “core” from the square / 5-power multiplier

Every qualifying \(k\) can be uniquely written as:

\[
k = m \cdot t
\]

where:

- \(m\) (the **core**) contains only split primes \(p \equiv 1,4 \pmod 5\) with exponents matching the chosen \((e+1)\)-pattern,
- \(t\) is any number of the form \(5^a \cdot s^2\) where \(s\) uses only inert primes.

For a fixed core \(m\), the number of valid multipliers is:

\[
W\left(\left\lfloor \frac{n}{m}\right\rfloor\right)
\]

where \(W(x)\) counts multipliers \(\le x\).

### 5) Efficient enumeration and quotient grouping

- We generate all exponent patterns whose \(\prod(e+1)\) equals \(2r\) or \(2r+1\), then iterate over split primes in increasing order.
- At the final prime choice, we use **integer-division grouping** (also called “quotient grouping”):
  for many consecutive primes the quotient \(\left\lfloor n/(m\cdot p^e)\right\rfloor\) is the same, so we count them in bulk using binary search on the prime list.

This keeps the \(n=10^{15}\) computation fast in pure Python.

---

## Output

Running `python3 main.py` prints the answer for:

\[
f(10^{15}, 40).
\]
