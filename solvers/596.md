# Project Euler 596 Solution - Number of Lattice Points in a Hyperball

<https://projecteuler.net/problem=596>:

* [596.py](596.py)

## Key math identities

### 1) Reduce the 4D lattice-point count to a sum over norms
Let
\[
T(r)=\#\{(x,y,z,t)\in\mathbb Z^4 : x^2+y^2+z^2+t^2\le r^2\}.
\]
If \(r_4(n)\) denotes the number of **ordered** integer quadruples with
\(x^2+y^2+z^2+t^2=n\), then
\[
T(r)=1+\sum_{n=1}^{r^2} r_4(n),
\]
where the “1” accounts for the all-zero quadruple.

### 2) Jacobi’s four-square theorem
Jacobi’s formula gives (for \(n>0\)):
\[
r_4(n)=8\sum_{d\mid n,\;4\nmid d} d.
\]
Summing this up to \(N=r^2\) and swapping the order of summation:
\[
\sum_{n\le N} r_4(n)=8\sum_{d\le N,\;4\nmid d} d\,\Big\lfloor\frac{N}{d}\Big\rfloor.
\]

### 3) Use a summatory sigma function
Define
\[
S(N)=\sum_{k=1}^N \sigma(k).
\]
A standard divisor-swap identity shows:
\[
S(N)=\sum_{d=1}^N d\,\Big\lfloor\frac{N}{d}\Big\rfloor.
\]
The “exclude multiples of 4” condition is handled by subtraction:
\[
\sum_{d\le N,\;4\nmid d} d\,\Big\lfloor\frac{N}{d}\Big\rfloor
= S(N)-4S(\lfloor N/4\rfloor).
\]
Putting it together:
\[
T(r)=1+8\big(S(r^2)-4S(\lfloor r^2/4\rfloor)\big).
\]

## Main algorithmic technique

### Floor-division grouping (a.k.a. hyperbola method)
To compute
\(
S(N)=\sum_{d=1}^N d\,\lfloor N/d\rfloor
\)
without iterating all \(d\), we exploit that the quotient
\(q=\lfloor N/d\rfloor\) is constant on intervals.

For a given \(d=i\):
- \(q=N//i\)
- the largest \(j\) with the same quotient is \(j=N//q\)

So we add one block at a time:
\[
\sum_{d=i}^j d\,q = q\sum_{d=i}^j d,
\]
and advance \(i\leftarrow j+1\).

This reduces the work to the number of distinct values of \(\lfloor N/d\rfloor\), and the sum over \([i,j]\) is computed via an arithmetic-series formula.

## Modulo arithmetic
The final answer is required modulo \(10^9+7\). The implementation performs all large computations modulo this prime, using the modular inverse of 2 for the arithmetic-series sums.

## Tests
The implementation includes `assert` checks for all sample values provided in the problem statement:
- \(T(2)=89\)
- \(T(5)=3121\)
- \(T(100)=493490641\)
- \(T(10^4)=49348022079085897\)
