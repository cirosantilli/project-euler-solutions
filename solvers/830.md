# Project Euler 830 Solution - Binomials and Powers

<https://projecteuler.net/problem=830>:

* [830.py](830.py)

We need to compute

\[
S(n)=\sum_{k=0}^{n}\binom{n}{k}k^n
\]

for \(n=10^{18}\), modulo \(83^3\cdot 89^3\cdot 97^3\).

## Key techniques

### 1) Change of basis via Stirling numbers
Use the standard expansion

\[
k^n = \sum_{j=0}^{n} S(n,j)\, (k)_j
\]

where \(S(n,j)\) are Stirling numbers of the 2nd kind and \((k)_j\) is the falling factorial.

Summing against binomial coefficients gives:

\[
\sum_{k=0}^{n}\binom{n}{k}(k)_j = n^{\underline{j}}\,2^{\,n-j}
\]

so

\[
S(n)=\sum_{j=0}^{n} S(n,j)\,n^{\underline{j}}\,2^{\,n-j}.
\]

Rewriting \(n^{\underline j}=\binom{n}{j}j!\) yields:

\[
S(n)=\sum_{j=0}^{n}\binom{n}{j}\,\bigl(j!\,S(n,j)\bigr)\,2^{\,n-j}.
\]

### 2) Avoid division: forward differences
The quantity \(j!\,S(n,j)\) can be computed without any modular division:

\[
j!\,S(n,j) = \sum_{t=0}^{j}(-1)^{j-t}\binom{j}{t}t^n
           = \Delta^{j}\bigl(t^n\bigr)\Big|_{t=0}.
\]

So we precompute \(t^n \bmod p^3\) for \(t=0..J\) and build a forward-difference table to obtain
all \(\Delta^{j}(t^n)\big|_{t=0}\) in \(O(J^2)\) time.

### 3) Truncation using p-adic valuation
Working modulo \(p^3\) (with \(p\in\{83,89,97\}\)), if the falling factorial \(n^{\underline j}\) is divisible by \(p^3\),
then the whole term is \(0 \bmod p^3\) because everything else in the term is an integer and \(2\) is invertible mod \(p^3\).

Since \(n^{\underline j}\) is a product of \(j\) consecutive integers, \(v_p(n^{\underline j})\) reaches \(3\) after only a few hundred
factors for these primes. Therefore the sum only needs to run up to a small \(J\) (around \(3p\)), even though \(n\) is enormous.

### 4) Chinese Remainder Theorem
Compute \(S(n)\) separately modulo each prime cube \(83^3\), \(89^3\), \(97^3\), then combine the three residues with CRT
to get the final answer modulo \(83^3\cdot 89^3\cdot 97^3\).

## Running

```bash
python3 main.py
The script asserts the provided test value 
ùëÜ
(
10
)
=
142469423360
S(10)=142469423360 and then prints the required residue for 
ùëõ
=
10
18
n=10 
18
 .
