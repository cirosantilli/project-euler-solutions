# Project Euler 332 Solution - Spherical Triangles

<https://projecteuler.net/problem=332>:

* [332.py](332.py)

## Core idea

For each radius `r`, enumerate all integer lattice points on the sphere:

\[
x^2 + y^2 + z^2 = r^2
\]

A spherical triangle is formed by choosing three such points (excluding degenerate triples that lie on a single great circle).  
Let `A(r)` be the minimum spherical area among those triangles, and compute:

\[
\sum_{r=1}^{50} A(r)
\]

## Techniques used

### 1) Robust spherical area formula (no spherical trig)

For **unit** vectors `u, v, w` on the sphere, the spherical excess (area on the unit sphere) is:

\[
E = 2\operatorname{atan2}\left(|\det(u,v,w)|,\; 1 + u\cdot v + v\cdot w + w\cdot u\right)
\]

For radius-`r` vectors `P, Q, R` (with `|P|=|Q|=|R|=r`), substitute `u=P/r` etc. and multiply by `r^2`:

\[
E = 2\operatorname{atan2}\left(\frac{|\det(P,Q,R)|}{r^3},\; 1 + \frac{P\cdot Q + Q\cdot R + R\cdot P}{r^2}\right),\quad
\text{area}=E\,r^2
\]

Degenerate triples have `det(P,Q,R)=0` and are skipped.

### 2) Determinant cutoff (safe pruning)

The denominator satisfies:

\[
1 + u\cdot v + v\cdot w + w\cdot u \le 4
\]

So for fixed determinant magnitude `D`, the area is bounded below by:

\[
\text{area} \ge 2r^2\operatorname{atan2}\left(\frac{D}{r^3}, 4\right)
\]

Given a current best area, we invert this into a safe cutoff:

\[
D \le 4r^3\tan\left(\frac{\text{best}}{2r^2}\right)
\]

Any triple with `|det| > D_max` cannot improve the best area and is skipped.

### 3) GCD pruning per pair

For fixed `(i,j)`:

\[
\det(P_i,P_j,P_k) = (P_i \times P_j)\cdot P_k
\]

Let `C = P_i × P_j`. Every value `C·P_k` is an integer linear combination of `C`'s components, hence a multiple of:

\[
g = \gcd(|C_x|, |C_y|, |C_z|)
\]

If `g > D_max`, then no non-degenerate `k` can satisfy `|det| ≤ D_max`, so the whole `k` loop is skipped.

### 4) Data layout for speed

- Coordinates are stored in `array('h')` (compact, fast indexing).
- The dot-product table is stored as a flat `array('h')` of length `n*n`.

This keeps inner loops lightweight while staying stdlib-only.

## Running

```bash
python3 main.py
```

The program prints the final sum rounded to 6 decimal places.
