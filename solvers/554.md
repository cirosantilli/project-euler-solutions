# Project Euler 554 Solution - Centaurs on a Chess Board

<https://projecteuler.net/problem=554>:

* [554.py](554.py)

We need to count maximum non‑attacking placements of **centaurs** (king + knight moves) on a `2n × 2n` chessboard.

Let `C(n)` be the number of ways to place `n²` centaurs so that none attacks another, and compute:

\[
\sum_{i=2}^{90} C(F_i) \pmod{100000007}
\]

where `F_i` are Fibonacci numbers (`F_1 = F_2 = 1`).

## Key techniques used

### 1) Closed form for `C(n)`
For this problem, the maximum number of non‑attacking centaurs on a `2n × 2n` board is `n²`, and the number of maximum placements satisfies the (integer) closed form:

\[
C(n) = 8\binom{2n}{n} - 3n^2 - 2n - 7
\]

So the whole task reduces to computing a central binomial coefficient modulo a prime.

### 2) Lucas theorem for huge `n` modulo a prime
The modulus is:

\[
p = 100000007
\]

which is prime, so **Lucas theorem** applies:

\[
\binom{N}{K} \equiv \prod \binom{N_i}{K_i} \pmod p
\]

where `N_i, K_i` are the base‑`p` digits of `N` and `K`.

Here we need \(\binom{2n}{n}\), and for the largest input (`n = F_90 ≈ 2.9×10^{18}`) there are only a few base‑`p` digits, so Lucas’ product is tiny.

### 3) Sparse factorial precomputation
To evaluate \(\binom{a}{b}\) for digits `a,b < p`, we use:

\[
\binom{a}{b} = a! \cdot (b!)^{-1} \cdot ((a-b)!)^{-1} \pmod p
\]

Precomputing all factorials up to `p-1` is too big for Python.  
Instead, we:

1. Collect **only** the digit values `a`, `b`, and `a-b` that ever appear in Lucas factors (plus the small test cases).
2. Sort them.
3. Do **one linear sweep** up to `max(target)` while recording factorial values only at the requested indices.

This keeps memory tiny while staying straightforward and fast enough.

### 4) Modular inverses via Fermat
Because `p` is prime:

\[
x^{-1} \equiv x^{p-2} \pmod p
\]

So the code computes inverse factorials with `pow(x, p-2, p)`.

## Correctness checks
The implementation includes asserts for the examples in the statement:

- `C(1) = 4`
- `C(2) = 25`
- `C(10) = 1477721`
