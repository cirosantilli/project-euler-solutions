# Project Euler 361 Solution - Subsequence of Thue-Morse Sequence

<https://projecteuler.net/problem=361>:

* [361.py](361.py)

# Subsequence of Thue-Morse Sequence

## Key Ideas
- The Thue-Morse word is generated by the morphism `0->01, 1->10`. Any factor (substring) of length `L>=4` comes either from an even start or an odd start, and those two sets are disjoint.
- This yields recurrences for the number of valid factors of a given length. Let `G(L)` be the number of factors of length `L` starting with `1`. Then for `L>=4`:
  - `G(2m) = G(m) + G(m+1)`
  - `G(2m+1) = 2*G(m+1)`
- The prefix sums `S(L)=sum_{i=1..L} G(i)` also satisfy a divide-and-conquer recurrence, allowing binary search to locate the length of `A_n`.
- Lexicographic order: among length-`L` factors that start with `1`, all even-start factors come before all odd-start factors. This allows recursive selection of the `k`-th word via the same halving structure.
- Values are computed modulo `1e9` using polynomial evaluation at powers of `2^{2^k}`. Each recursion level shifts the evaluation index by one, so only `O(log L)` precomputed powers are needed.

## Implementation Notes
- `main.py` builds a compact word-structure tree for the `k`-th factor without expanding it.
- Cached functions provide:
  - counts and prefix sums of valid factors,
  - first/last-bit access and drop-first/drop-last transformations,
  - fast evaluation of the constructed word modulo `1e9`.
- Assertions for `A_100` and `A_1000` are included, then the required sum is printed.
