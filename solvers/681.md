# Project Euler 681 Solution - Maximal Area

<https://projecteuler.net/problem=681>:

* [681.py](681.py)

This solution avoids brute-force enumeration of side lengths by transforming the geometry problem into a constrained integer factorization problem.

---

## 1) Key Geometry Insight (Brahmagupta)

The maximum area of a quadrilateral with sides `a,b,c,d` occurs when it is **cyclic**.
For cyclic quadrilaterals:

\[
A^2 = (s-a)(s-b)(s-c)(s-d)
\]

where:

\[
s = \frac{a+b+c+d}{2}
\]

Define:

- `U = s-a`
- `V = s-b`
- `W = s-c`
- `T = s-d`

Then:

\[
A = \sqrt{U V W T}
\]

---

## 2) Ordering Trick

If `a ≤ b ≤ c ≤ d`, then:

\[
U ≥ V ≥ W ≥ T
\]

Also the perimeter is:

\[
a+b+c+d = 2s = U+V+W+T
\]

So instead of summing over side quadruples, we sum over `(U,V,W,T)`.

---

## 3) Integer Area Condition

We require the maximal area `A` to be an integer ≤ `n`.

That means:

\[
U V W T = k^2
\]

for some integer `k ≤ n`.

So the problem becomes:

- For each `k = 1..n`
- Find all `U≥V≥W≥T≥1` with `U·V·W·T = k²`
- Require `U < V+W+T` (positivity of smallest side)
- Require `U+V+W+T` even (ensures sides are integers)
- Sum perimeter `U+V+W+T`

---

## 4) Efficient Enumeration Strategy

For fixed `k`, we enumerate **divisors of `k²` that are ≤ k**, since:

- `V ≤ k` must hold (otherwise `U < V`).
- Hence also `W,T ≤ k`.

We choose `T`, then `W`, then `V`, and compute:

\[
U = \frac{k^2}{T W V}
\]

Then we check ordering, parity, and the inequality `U < V+W+T`.

---

## 5) Pruning via a Quadratic Bound

The condition:

\[
U = \frac{k^2}{T W V} < V + W + T
\]

can be rearranged to a quadratic inequality in `V`, yielding a **tight lower bound** for feasible `V`.
That massively reduces the number of divisor checks per `k`.

---

## 6) Complexity Notes

- Prime factorization for all `k ≤ n` is done via a smallest-prime-factor sieve.
- Divisor generation per `k` is small because the divisor list is restricted to `≤ k`.
- Strong pruning keeps the search practical.

---

## 7) Verification

The implementation includes asserts for:

- `SP(10) = 186`
- `SP(100) = 23238`

The final value for `SP(1_000_000)` is computed and printed at runtime.
