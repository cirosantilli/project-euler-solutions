# Project Euler 568 Solution - Reciprocal Games II

<https://projecteuler.net/problem=568>:

* [568.py](568.py)

## Key idea: reduce everything to a closed form

For each turn, a number `k` is chosen uniformly from `1..n`, and the payoff (if you win) is `1/k`.

### Game A (one draw)
One activation produces a random bit pattern on `n` bulbs, i.e. a binomial count:

- `P(#on = k) = C(n,k) / 2^n`

So the expected payoff per turn is:

\[
\frac1n \sum_{k=1}^n \frac1k\frac{\binom{n}{k}}{2^n}
\]

Multiplying by `n` turns gives:

\[
J_A(n) = \sum_{k=1}^n \frac{\binom{n}{k}}{k\,2^n}
\]

### Game B (rejection sampling to exactly `k`)
If you repeatedly sample random bit patterns until you get exactly `k` lights on, **every** pattern with `k` ones is equally likely (each has probability `1/2^n` before conditioning). Therefore:

- Tom’s final pattern is uniform over the `C(n,k)` valid patterns.
- Jerry’s final pattern is an independent uniform draw from the same set.

So:

\[
P(\text{match}) = \frac{1}{\binom{n}{k}}
\]

Expected payoff per turn is `(1/k) * 1/C(n,k)`, and over `n` turns:

\[
J_B(n) = \sum_{k=1}^n \frac{1}{k\binom{n}{k}}
\]

### The difference collapses to a harmonic number

Let:

\[
D(n)=J_B(n)-J_A(n)
\]

Using the integral identity `1/k = ∫_0^1 x^{k-1} dx` and the beta integral
\[
\frac{1}{k\binom{n}{k}} = \frac{(k-1)!(n-k)!}{n!} = \int_0^1 x^{k-1}(1-x)^{n-k}\,dx
\]
you can show:

\[
2^n D(n) = \int_0^1 \frac{1-(1-x)^n}{x}\,dx
         = \int_0^1 \frac{1-u^n}{1-u}\,du
         = \sum_{m=1}^n \frac1m = H_n
\]

So the problem reduces to the exact closed form:

\[
\boxed{D(n) = \frac{H_n}{2^n}}
\]

## Computing the first 7 significant digits for huge `n`

`n = 123456789` is far too large to compute `H_n` by summation or to form `2^n`.
Instead we compute:

\[
\log_{10} D(n) = \log_{10} H_n - n \log_{10} 2
\]

Then the **fractional** part of `log10(D(n))` determines the scientific-notation mantissa.
To get `H_n` accurately we use the Euler–Maclaurin expansion:

\[
H_n = \ln n + \gamma + \frac{1}{2n} - \frac{1}{12n^2}
      + \frac{1}{120n^4} - \frac{1}{252n^6}
      + \frac{1}{240n^8} - \frac{1}{132n^{10}} + \cdots
\]

With `decimal.Decimal` at high precision, this is easily accurate enough to extract the
leading 7 digits of `D(n)`.

## What the code does

- Verifies the sample values for `n=6` with exact rational arithmetic (`fractions.Fraction`).
- Uses the proven identity `D(n)=H_n/2^n`.
- Computes `H_n` via Euler–Maclaurin and extracts the leading digits using base-10 logs.

Running `python3 main.py` prints the required 7-digit answer.
