# Project Euler 389 Solution - Platonic Dice

<https://projecteuler.net/problem=389>:

* [389.py](389.py)

## Key idea: compound sums

Each stage is a **random sum of i.i.d. dice**:

- Roll a die to get a count `N`
- Roll `N` dice of the next type and sum them

If

- `Y` is one die roll (mean `μ`, variance `σ²`)
- `N` is the random number of dice (mean `E[N]`, variance `Var(N)`)
- `X = Y₁ + … + Y_N` with `Yᵢ` i.i.d. and independent of `N`

then:

- `E[X] = E[N] · μ`
- `Var(X) = E[N] · σ² + Var(N) · μ²`

This is just the law of total expectation and the law of total variance:
`Var(X) = E[Var(X|N)] + Var(E[X|N])`.

Applying these two formulas repeatedly lets us propagate `(mean, variance)` through the whole chain without ever building the full distribution (which would be enormous).

## Exact arithmetic

The means and variances of a fair `s`-sided die (`1..s`) are rational numbers:

- `μ = (s+1)/2`
- `σ² = (s²−1)/12`

The implementation uses `fractions.Fraction` to keep all intermediate results exact, and only rounds at the very end.

## Output formatting

Rounding to 4 decimal places is done with integer arithmetic (scaled numerator/denominator) and **half-up** rounding to avoid any floating-point edge cases.

## Self-checks

A couple of lightweight assertions validate:

- the closed-form mean/variance for a standard die
- the compound-sum variance formula against a tiny brute-force distribution (2-sided dice)
