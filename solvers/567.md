# Project Euler 567 Solution - Reciprocal Games I

<https://projecteuler.net/problem=567>:

* [567.py](567.py)

This solution computes

\[
S(m)=\sum_{n=1}^{m} \left(J_A(n)+J_B(n)\right)
\quad\text{for } m=123456789
\]

rounded to **8 decimal places**, without any external libraries.

---

## Key algebraic simplifications

### 1) Game A becomes a binomial expectation

Let \(X\sim\text{Binomial}(n,\tfrac12)\) be the number of lights on after one activation.

Game A wins \(\tfrac1k\) exactly when \(X=k\), so

\[
J_A(n)=\sum_{k=1}^{n}\frac{1}{k}\Pr[X=k]
      =\sum_{k=1}^{n}\frac{1}{k}\frac{\binom{n}{k}}{2^n}.
\]

A crucial recurrence for

\[
T_n=\sum_{k=1}^{n}\frac{\binom{n}{k}}{k}
\]

comes from \(\binom{n}{k}=\binom{n-1}{k}+\binom{n-1}{k-1}\):

\[
T_n = T_{n-1} + \sum_{j=0}^{n-1}\frac{\binom{n-1}{j}}{j+1}
    = T_{n-1} + \frac{2^n-1}{n},
\]

using the classic identity

\[
\sum_{j=0}^{n-1}\frac{\binom{n-1}{j}}{j+1}=\frac{2^n-1}{n}.
\]

From this you can rewrite \(J_A(n)\) as a **short base-2 series**:

\[
J_A(n)=\sum_{j=0}^{n-1}\frac{2^{-j}}{n-j}-\frac{H_n}{2^n},
\]

and the \(2^{-j}\) tail dies extremely fast, so only ~80 terms are needed for
full double-precision accuracy even when \(n\) is \(10^8\).

---

### 2) Game B reduces to reciprocal binomial coefficients

Using \(\binom{n}{k}=\frac{n}{k}\binom{n-1}{k-1}\),

\[
\frac{1}{k\binom{n}{k}}=\frac{1}{n\binom{n-1}{k-1}}.
\]

Therefore

\[
J_B(n)=\frac{1}{n}\sum_{j=0}^{n-1}\frac{1}{\binom{n-1}{j}}.
\]

For large \(n\), \(\binom{n-1}{j}\) is enormous except near the edges, so the
sum is dominated by small \(j\) and (by symmetry) large \(j\). We compute a small
number of edge terms via the recurrence

\[
\frac{1}{\binom{N}{j}}=\frac{1}{\binom{N}{j-1}}\cdot \frac{j}{N-j+1},
\]

and then double the edge sum.

---

### 3) The whole prefix sum collapses to a single expression

By swapping summations and using telescoping identities, one can show:

\[
\sum_{n=1}^{m}J_A(n)
=2H_m-2\sum_{i=1}^{m}\frac{2^{-i}}{i}-J_A(m),
\]

\[
\sum_{n=1}^{m}J_B(n)
=H_m+H_{m-1}+\frac1m-J_B(m).
\]

Since \(H_{m-1}=H_m-\frac1m\), adding these gives the very clean formula:

\[
\boxed{
S(m)=4H_m-2\sum_{i=1}^{m}\frac{2^{-i}}{i}-(J_A(m)+J_B(m))
}
\]

This turns a problem that *looks* like it needs \(O(m^2)\) work into an **\(O(1)\)**
computation.

---

## Numerical techniques used

- **Eulerâ€“Maclaurin expansion** for the harmonic number \(H_m\):
  \[
  H_m=\ln(m)+\gamma+\frac{1}{2m}-\frac{1}{12m^2}+\cdots
  \]
  For \(m\approx 10^8\), the first couple of correction terms already exceed the
  required precision.

- **Closed form** for the power series:
  \[
  \sum_{i=1}^{\infty}\frac{2^{-i}}{i}=\ln 2.
  \]
  For \(m=123456789\) the tail past \(m\) is effectively zero.

- **Fast-decaying edge sums** for \(J_A(m)\) and \(J_B(m)\), using powers of two
  and reciprocal binomial recurrences.

---

## Validation

The code includes asserts for the sample values from the statement:

- \(J_A(6)=0.39505208\)
- \(J_B(6)=0.43333333\)
- \(S(6)=7.58932292\)

(all rounded to 8 decimals).

---

## Output

Running `python3 main.py` prints the answer for \(S(123456789)\) to 8 decimals.
