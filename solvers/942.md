# Project Euler 942 Solution - Mersenne's Square Root

<https://projecteuler.net/problem=942>:

* [942.py](942.py)

This solution computes the minimal square root `R(q)` of `q` modulo the Mersenne number `p = 2^q − 1`, for the instance where `p` is prime and the final answer is required modulo `10^9+7`.

## Main ideas

### 1) Use a Gauss sum instead of modular exponentiation

For an odd prime `q`, let `(a/q)` be the Legendre symbol (quadratic character modulo `q`).
If `p = 2^q − 1` is prime, then `2` has exact order `q` modulo `p`, i.e. `2` is a primitive `q`‑th root of unity in the field `F_p`.

Define the (quadratic) Gauss/Fekete sum

```
G = Σ_{a=1..q−1} (a/q) · 2^a
```

A classical Gauss sum identity gives

```
G^2 ≡ (−1)^{(q−1)/2} · q   (mod p)
```

For the problem’s `q` (which is `1 mod 4`), the factor `(−1)^{(q−1)/2}` is `+1`, hence `G` is a square root of `q` modulo `p` (up to sign). This avoids computing `q^{(p+1)/4} mod p`, which is infeasible here.

### 2) Compute `G` modulo `10^9+7` directly

`G` is just a `+/-` sum of powers of `2`. To get the final answer modulo `10^9+7`, we can compute the same sum modulo `10^9+7`.

The only missing ingredient is the Legendre symbol values `(a/q)` for `a = 1..q−1`.

### 3) Build the Legendre symbol table by marking quadratic residues

For prime `q`, the nonzero quadratic residues are exactly `{ i^2 mod q : i = 1..(q−1)/2 }`, and each residue appears exactly once in that range.

So we create a `bytearray` of length `q` and mark `qr[r] = 1` for each residue `r`. Then

- if `qr[a] == 1`, `(a/q) = +1`
- otherwise `(a/q) = −1`

The running power `2^a (mod 10^9+7)` is updated with a single doubling per step.

### 4) Choose the *minimal* root without ever constructing `p`

Once a root `G (mod p)` is known, the two roots are `G` and `p−G`. The minimal root is the smaller of the two.

For `q ≡ 1 (mod 4)`, the top term `2^{q−1}` in `G` has coefficient `(+1)`, so we can write

```
G = 2^{q−1} + L
```

where `L` uses only lower powers `2^a` for `a ≤ q−2`. The sign of `L` is determined solely by the coefficient of its highest term `2^{q−2}`, which is `(−2/q)`.

- If `(−2/q) = +1`, then `L > 0` and `G > 2^{q−1}`, so the minimal root is `p − G`.
- If `(−2/q) = −1`, then `L < 0` and `G < 2^{q−1}`, so the minimal root is `G`.

`(−2/q)` is computed from `q mod 8` using the standard quadratic character formula.

## Complexity notes

- Time: `O(q)` operations.
- Memory: `O(q)` bytes for the quadratic-residue table.

This is practical because the final output is required modulo a small prime (`10^9+7`), and we never perform arithmetic modulo the enormous Mersenne prime `p`.
