# Project Euler 444 Solution - The Roundtable Lottery

<https://projecteuler.net/problem=444>:

* [444.py](444.py)

This solution relies on two closed-form observations.

## 1) Game analysis: `E(p) = H_p`

Under optimal play, the end-of-game players correspond exactly to the **record highs** (“left-to-right maxima”) in the order that ticket values are revealed.

- When a new **highest so far** value appears, it is always optimal for the current player (and any future player) to prefer that known best ticket over any smaller known ticket.
- Any player facing only non-record tickets can do better (in expectation) by continuing, so non-record tickets are “discarded” via trades.
- Therefore, the number of players left equals the number of record highs in a random permutation of `1..p`.

A standard fact: the expected number of record highs in a random permutation of length `p` is the harmonic number

\[
H_p = \sum_{i=1}^{p} \frac{1}{i}.
\]

So `E(p) = H_p`.

## 2) Iterated summation: `S_k(N)` collapses neatly

The problem defines:

- `S_1(N) = sum_{p=1..N} E(p)`
- `S_k(N) = sum_{p=1..N} S_{k-1}(p)` for `k>1`

With `E(p)=H_p`, the k-fold summation has a compact closed form:

\[
S_k(N) = \binom{N+k}{k}\left(H_{N+k} - H_k\right).
\]

This can be proven by induction using the identity

\[
\binom{N+k}{k} = \binom{N+k-1}{k} + \binom{N+k-1}{k-1}
\]

and the telescoping behavior of harmonic numbers.

## 3) Numerical computation

For `N=10^14, k=20`:

- `binom(N+k, k)` is computed **exactly** as a Python big integer (`math.comb`).
- `H_{N+k}` is computed using an **Euler–Maclaurin** expansion:

\[
H_n = \ln(n) + \gamma + \frac{1}{2n} - \frac{1}{12n^2} + \frac{1}{120n^4} - \cdots
\]

This is extremely accurate for such large `n`.
- `decimal.Decimal` is used to keep plenty of guard digits and to ensure correct rounding to **10 significant digits** in the final scientific-notation output.

## Included checks

The code asserts both sample values from the statement:

- `E(111) = 5.2912` (5 significant digits)
- `S_3(100) = 5.983679014e5` (10 significant digits)
