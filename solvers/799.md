# Project Euler 799 Solution - Pentagonal Puzzle

<https://projecteuler.net/problem=799>:

* [799.py](799.py)

This solution hinges on turning a “sum of pentagonal numbers” problem into a **sum of two squares** problem, and then searching efficiently.

## Key transformation

Pentagonal numbers satisfy:

- \(P_n = \frac{n(3n-1)}{2}\)
- \(24P_n + 1 = (6n-1)^2\)

If:

\[
P_m = P_a + P_b
\]

then:

\[
(6m-1)^2 + 1 = (6a-1)^2 + (6b-1)^2
\]

So for each \(m\), define:

\[
N = (6m-1)^2 + 1
\]

and count representations of \(N\) as a sum of two squares.

### The “pentagonal” congruence filter

We only want representations where the square roots correspond to values of the form \(6n-1\), i.e. numbers congruent to \(5 \pmod 6\).

Because \(N\) here always forces both square roots to be odd, the filter reduces cleanly to:

- keep only pairs \((u,v)\) with **\(u \equiv v \equiv 2 \pmod 3\)**

Each surviving pair corresponds to a unique \((a,b)\) with:

\[
u = 6a-1,\quad v = 6b-1
\]

## Counting representations using Gaussian integers

For primes \(p \equiv 1 \pmod 4\), there exists a representation:

\[
p = a^2 + b^2
\]

Using **Cornacchia’s algorithm**, we find such \((a,b)\) efficiently from a square root of \(-1 \pmod p\).

In the Gaussian integers \(\mathbb{Z}[i]\), each such prime splits as:

\[
p = (a+bi)(a-bi)
\]

For a prime power \(p^e\), all factors of norm \(p^e\) arise from choosing how many copies of \((a+bi)\) vs \((a-bi)\) you take. Combining these choices across all primes (via complex multiplication) enumerates all \((u,v)\) with:

\[
u^2 + v^2 = N
\]

Finally, apply the \(u \equiv v \equiv 2 \pmod 3\) filter and count distinct unordered positive pairs.

## Fast search: segmented modular “sieving” over \(m\)

Brute-forcing each \(m\) with full factorization is too slow. Instead:

1. Work in blocks of consecutive \(m\).
2. For many small primes \(p \equiv 1 \pmod 4\), precompute the two residues \(r\) such that:

   \[
   p \mid (6m-1)^2 + 1 \quad \Longleftrightarrow \quad m \equiv r \pmod p
   \]

3. In each block, quickly divide out these primes from \(N/2\) for the matching indices, maintaining the partial product \(\prod (e+1)\).

This gives a strong **upper bound** on how many sum-of-two-squares representations are even possible. Only rare candidates can reach more than 100 ways, so only those are checked exactly.

## Final exact check

For the remaining candidates:

- factor \(N\) completely with a 64-bit **deterministic Miller–Rabin** primality test and **Pollard Rho** factorization,
- enumerate Gaussian-integer combinations,
- apply the modulo-3 filter,
- take the first \(m\) with more than 100 valid representations and output \(P_m\).

## Built-in verification

The code asserts the example counts given in the problem statement:

- \(P_8 = 92\) has 1 representation as a sum of two pentagonal numbers.
- \(P_{49} = 3577\) has 2 representations.
- \(P_{268} = 107602\) has 3 representations.
