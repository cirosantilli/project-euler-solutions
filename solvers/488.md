# Project Euler 488 Solution - Unbalanced Nim

<https://projecteuler.net/problem=488>:

* [488.py](488.py)

## Key observation: losing positions become an XOR condition
This game is the 3-heap Nim variant sometimes called **Antonim** (no two heaps may be equal after a move).

For **three** heaps, losing positions (P-positions) have a clean characterization:

> A position `(a,b,c)` (with distinct heap sizes, allowing 0) is losing **iff**  
> `(a+1) XOR (b+1) XOR (c+1) = 0`.

This matches the samples, e.g. `(2,4,5)` gives `3 XOR 5 XOR 6 = 0`.

Because the Project Euler sum is over `0 < a < b < c < N`, we shift:
- `x=a+1`, `y=b+1`, `z=c+1`
- so `2 ≤ x < y < z ≤ N`
- and `x XOR y XOR z = 0`.

Then each losing triple contributes:
- `a+b+c = (x+y+z) - 3`.

## Counting without enumeration: digit DP on bits
From `x XOR y XOR z = 0`, we have `z = x XOR y`, so we count ordered pairs `(x,y)` with:
- `2 ≤ x ≤ N`, `2 ≤ y ≤ N`
- `2 ≤ (x XOR y) ≤ N`.

We compute counts and sums using a **bitwise digit DP** over the constraints:
- `x ≤ A`, `y ≤ B`, `(x XOR y) ≤ C`.

The DP processes bits from MSB → LSB and keeps 3 “tight” flags (for x, y, and xor), which yields only `2³ = 8` states.

In addition to counting solutions, the same DP accumulates:
- `Σx`, `Σy`, `Σ(x XOR y)`  
so we can obtain `Σ(x+y+z)`.

## Enforcing the lower bound `≥ 2` via inclusion–exclusion
The DP naturally counts solutions with variables in `[0..bound]`.
To require `x,y,z ≥ 2`, we exclude `{0,1}` by inclusion–exclusion on:
- `x ≤ 1`, `y ≤ 1`, `z ≤ 1`.

This needs only `2³ = 8` DP calls per `N`.

## From ordered to strictly increasing triples
With `x,y,z ≥ 2`, any XOR-zero triple automatically has **all three values distinct** (if two were equal, the third would be 0).
Therefore, each unordered triple corresponds to exactly `6` ordered permutations.

So:
- `Σ_{x<y<z}(x+y+z) = (Σ ordered (x+y+z)) / 6`
- and the desired `F(N) = (Σ ordered (x+y+z) - 3·(#ordered)) / 6`.

Finally we print the last 9 digits (zero-padded).

## Complexity
- Bit length is ~60 for `10^18`.
- DP work is `O(bits · states · choices) ≈ 60 · 8 · 4`, tiny.
- Total runtime is effectively constant, with exact integer arithmetic.
