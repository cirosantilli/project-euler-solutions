# Project Euler 632 Solution - Square Prime Factors

<https://projecteuler.net/problem=632>:

* [632.py](632.py)

This solution computes

- `C_k(N)`: how many integers `1..N` have exactly `k` **square prime factors** (primes `p` with `p² | n`)
- the required output: the product of all non-zero `C_k(10¹⁶)` modulo `1_000_000_007`

The program prints the final answer for `N = 10^16`.

## Key ideas

### 1) Convert “exactly k” into binomial moments

Let `f(n)` be the number of square prime factors of `n`.

Instead of counting `f(n)=k` directly, compute for each `r`:

\[
S_r(N) = \sum_{n \le N} \binom{f(n)}{r}.
\]

For a fixed `n`, `binom(f(n), r)` counts how many `r`-subsets of its square prime factors exist.

A subset corresponds to a **squarefree** number `d` with exactly `r` prime factors, where `d² | n`.
So we can swap the order of counting:

\[
S_r(N) = \sum_{\substack{d\ \text{squarefree} \\ \omega(d)=r}} \left\lfloor \frac{N}{d^2} \right\rfloor .
\]

Here `ω(d)` is the number of distinct prime factors.

### 2) Recover `C_k(N)` by binomial inversion

The quantities satisfy:

\[
S_r(N) = \sum_{k \ge r} C_k(N)\binom{k}{r}.
\]

This is an upper-triangular linear system, so we can invert it (from large `k` down to `0`) to get all `C_k(N)`.

### 3) Efficient computation of `S_r(N)` for `N=10^16`

We must sum over squarefree `d` up to `sqrt(N)=10^8`. Doing it directly is too big, so we split:

- **Small `d`**: `d <= L0` (with `L0 = 5,000,000`)
  - We compute `μ(d)` (Möbius) and `ω(d)` (number of prime factors) using a **linear sieve**
  - Add `floor(N/d²)` to the appropriate `S_r` when `μ(d) != 0` (squarefree)

- **Large `d`**: `d > L0`
  - Here `q = floor(N/d²)` is small (at most `N/(L0+1)²`, about `400`)
  - Group all `d` with the same `q`:
    - they lie in an interval `( sqrt(N/(q+1)), sqrt(N/q) ]`
  - For each interval, we only need **how many squarefree numbers have exactly `r` prime factors**
    up to a bound `x` — computed by a small recursive combinatorial counter.

### 4) Prime generation and counting

- Primes up to `10^8` are generated once with an **odd-only sieve**.
- `π(x)` (number of primes ≤ x) is answered by `bisect` on the prime list.
- The squarefree product counter uses only small primes (≤ 10,000), so recursion stays fast.

## What’s in `main.py`

- Asserts for every test row given in the problem statement.
- A fast solver for `N=10^16`.
- Prints the final result modulo `1_000_000_007`.
