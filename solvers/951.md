# Project Euler 951 Solution - A Game of Chance

<https://projecteuler.net/problem=951>:

* [951.py](951.py)

## Core idea: only the parity of the number of turns matters

There are no player decisions: the only randomness is the coin tossed when the top two cards have the same colour.
Therefore the winner is determined entirely by how many **turns** are taken until the deck is empty.

- Player 1 moves on turns 1, 3, 5, …
- Player 2 moves on turns 2, 4, 6, …

So Player 1 wins **iff** the total number of turns is **odd**.

## Decompose the deck into maximal runs

Write the shuffled deck as maximal same-colour runs, e.g.

- `RRBBBR` → run lengths `(2, 3, 1)`.

During play, the coin is tossed **only inside a run** (when the run has at least two remaining cards).
Runs are consumed from the top; once a run is exhausted, play continues on the next run.

Crucially, the number of turns needed to consume a run of length `L` depends **only on `L`**, and different runs use disjoint coin tosses.
So the numbers of turns for different runs are independent random variables.

## Parity of turns for a single run

Let `S(L)` be the (random) number of turns required to remove a run of length `L`.
For `L ≥ 2`, one turn always removes 1 card, and then removes a second card with probability `1/2`:

- with probability `1/2`: `S(L) = 1 + S(L-1)`
- with probability `1/2`: `S(L) = 1 + S(L-2)`

To track only **parity**, use

- `t(L) = E[(-1)^{S(L)}]`.

Then the recurrence becomes

- `t(0)=1`, `t(1)=-1`
- `t(L) = -(t(L-1) + t(L-2))/2` for `L ≥ 2`.

If a run has `P(S(L) odd)=P(S(L) even)=1/2`, then `t(L)=0` and that run alone makes the overall parity perfectly balanced.
For the sizes relevant to this problem, only `L=2` produces `t(L)=0`.

**Conclusion:** a starting configuration is *fair* **iff** its run decomposition contains at least one maximal run of length **2**.

## Counting fair configurations

Let

- `Total(n) = C(2n, n)` be the number of balanced red/black decks.
- `A(n)` be the number of balanced decks with **no** maximal run of length 2.

Then

- `F(n) = Total(n) - A(n)`.

### DP for `A(n)` (strings with no run of length 2)

Build the string left-to-right with a small automaton state:

- counts of `R` used so far (then `B` is implied by position),
- last colour,
- current run length category: `1`, `2`, or `≥3`.

The constraint “no maximal run of length 2” is simply:

- you may **not switch colours** immediately after reaching run length `2`.
- the final run is also not allowed to end at length `2`.

This DP runs in `O(n^3)` time with tiny constants (here `n=26`).

## Files

- `main.py` computes `F(26)` and prints it.
- It includes asserts for the example values from the statement.
