# Project Euler 583 Solution - Heron Envelopes

<https://projecteuler.net/problem=583>:

* [583.py](583.py)

This solution computes:

- **S(p)** = the sum of perimeters of all *Heron envelopes* with perimeter ≤ **p**
- Given check: **S(10⁴) = 884680**
- Task: compute **S(10⁷)**

---

## 1) Geometry → Integer Right Triangles (Key Reduction)

An envelope consists of:

- A rectangle of width **w** and height **h**
- An isosceles flap triangle with base **w** and equal sides **s**

All boundary edges must be integers, and the diagonals:

- **AC, AD, BD, BE, CE** must also be integers.

### Crucial simplification

Let **a = w/2**.

It can be shown the conditions force **w to be even**, hence **a is integer** and the flap height becomes integer as well.

Introduce:

- **t** = perpendicular flap height (integer)
- **u = h + t**

Then the required integrality becomes **three Pythagorean conditions**:

1. `a² + t² = s²`  
   (half of the isosceles triangle)

2. `a² + (h+t)² = e²`  
   (diagonal AC = CE)

3. `(2a)² + h² = d²`  
   (rectangle diagonals AD = BE)

So the whole envelope is described by linked integer right triangles.

---

## 2) Perimeter Bound

The envelope perimeter is:

`P = w + 2h + 2s = 2a + 2h + 2s = 2(a + h + s)`

So for a perimeter limit **p**, we define:

`N = p/2`

and require:

`a + h + s ≤ N`

---

## 3) Enumerating Pythagorean Triples (Euclid’s Formula)

All primitive Pythagorean triples are generated using:

- `a = m² - n²`
- `b = 2mn`
- `c = m² + n²`

with:

- `gcd(m,n)=1`
- `m-n` odd

Scaling by `k` yields all triples.

---

## 4) Fast Lookup with CSR Adjacency Lists

We need to test condition (2) many times:

> for a fixed **a**, find all **u** such that `a² + u²` is a square.

We build a compressed sparse row (CSR) adjacency list:

- `U[a] = {u}` for all `1 ≤ a,u ≤ N` satisfying Pythagorean condition.

This avoids factoring or repeated square tests.

---

## 5) Main Loop

1. Build `U[a]` using Euclid triples with legs ≤ N  
2. Enumerate flap-half triples `(a,t,s)` with `s ≤ N`
3. For each candidate `u ∈ U[a]`:
   - `h = u - t`
   - must satisfy: `h > t` and `a + h + s ≤ N`
   - check rectangle: `(2a)² + h²` is a perfect square
4. Add perimeter: `2(a + h + s)`

---

## 6) Correctness Check

The solution includes the statement’s check:

```python
assert S(10**4) == 884680
