# Project Euler 666 Solution - Polymorphic Bacteria

<https://projecteuler.net/problem=666>:

* [666.py](666.py)

## Key idea: multi-type branching processes
Each bacterium transforms once per minute, producing a random “offspring multiset” of types for the next minute.
This is exactly a **multi-type Galton–Watson branching process** with `k` types.

Let `p[i]` be the probability that the population eventually dies out when starting from a single bacterium of type `α_i`.
Then `p` satisfies the standard extinction fixed-point equations:

- `p[i] = E[ Π_t p[t]^(N_t) ]`

where `N_t` is the number of children of type `t` produced by one parent of type `i` in the next minute.

## Turning the rules into generating functions
For each type `i` and each `j in [0, m)`, compute:

- `q = r[i*m + j] mod 5` where `r` is the given squaring-mod sequence.

Since `j` is chosen uniformly, each type `i` has fixed probabilities `a0..a4` for the five actions (`q=0..4`),
computed simply by counting how many `j` values yield each `q`.

That gives, for each `i`, the polynomial equation:

- dies (`q=0`): contributes `1`
- clones (`q=1`): contributes `p[i]^2`
- mutates (`q=2`): contributes `p[2i mod k]`
- splits into 3 (`q=3`): contributes `p[(i^2+1) mod k]^3`
- spawns one new (`q=4`): contributes `p[i] * p[(i+1) mod k]`

and `p[i]` is the average of these contributions with weights `a0..a4`.

## Solving the system
The mapping `F(p)` given by these equations is monotone on `[0,1]^k`.
The **extinction probability vector is the least fixed point** of `F`.

So we use **monotone fixed-point iteration**:

1. start with `p = 0`
2. repeatedly set `p <- F(p)`
3. stop when the maximum coordinate change is below a small tolerance

This converges quickly for the required instances (including `k=500, m=10`).

## Implementation notes
- Precompute `r_n` only up to `k*m - 1` (the largest index needed).
- Store the per-type action probabilities `a0..a4` and transition targets (`2i`, `i^2+1`, `i+1`) once.
- Each iteration is `O(k)` and uses only a few array lookups per type.
