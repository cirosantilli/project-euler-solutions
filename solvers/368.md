# Project Euler 368 Solution - A Kempner-like Series

<https://projecteuler.net/problem=368>:

* [368.py](368.py)

We want:

\[
\sum_{n\ge 1\ \text{and}\ n\ \text{has no run of } \ge 3\ \text{equal consecutive digits}} \frac1n
\]

and we must output the limit rounded to **10 digits after the decimal point**.

## Key techniques

### 1) Model the “no 3 equal consecutive digits” rule as a tiny automaton
A valid number can only end with:

- a run of length **1** of its last digit, or
- a run of length **2** of its last digit.

So we classify valid numbers of a fixed decimal length `L` into two disjoint buckets:

- `S1(L, d)`: `L`-digit numbers ending in digit `d` with final run length **1**
- `S2(L, d)`: `L`-digit numbers ending in digit `d` with final run length **2**

This is exactly a small finite-state machine (last digit + run length).

### 2) Track power sums, not individual numbers
For each length `L`, digit `d`, and exponent `j`, we maintain:

- `f1[d][j] = Σ_{x ∈ S1(L,d)} 1 / x^j`
- `f2[d][j] = Σ_{x ∈ S2(L,d)} 1 / x^j`

The answer we want is the sum of `j = 1` terms across all lengths.

### 3) Append-a-digit recurrence via a binomial series expansion
When we append a digit `d` to a prefix `y`, we get `x = 10y + d`. For any integer `j ≥ 1`:

\[
\frac{1}{(10y+d)^j}
= 10^{-j}\,y^{-j}\,\Bigl(1+\frac{d}{10y}\Bigr)^{-j}
\]

Use the negative binomial series:

\[
(1+u)^{-j}=\sum_{i\ge 0} \binom{j+i-1}{i}(-u)^i
\]

to obtain:

\[
\frac{1}{(10y+d)^j}
=10^{-j}\sum_{i\ge 0}\binom{j+i-1}{i}\left(\frac{-d}{10}\right)^i \frac{1}{y^{j+i}}
\]

Now summing over all valid prefixes `y` turns the “append digit” step into a recurrence
that only involves previously-computed power sums of higher exponent (`j+i`).

### 4) Practical truncation and tail bounding
- The inner series over `i` decays very quickly; keeping only a small maximum exponent (`K=20`) is already enough for 10-decimal output.
- Contributions by decimal length eventually decrease geometrically, so we stop once a conservative geometric tail bound is below a tiny tolerance.

## Statement-based checks

`main.py` includes asserts for the two facts explicitly mentioned in the statement:

1. Among denominators `1..1200`, exactly **20** are omitted, and they match the listed values.
2. The classic Kempner series that omits denominators containing digit `9` converges to approximately **22.9206766193** (checked to a small tolerance).
