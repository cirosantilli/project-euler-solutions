# Project Euler 365 Solution - A Huge Binomial Coefficient

<https://projecteuler.net/problem=365>:

* [365.py](365.py)

We need to compute:

\[
\sum M(10^{18},10^9,pqr)\quad\text{for primes }1000<p<q<r<5000
\]

where \(M(n,k,m)=\binom{n}{k}\bmod m\).

The direct binomial coefficient is astronomically large, so the solution relies entirely on modular arithmetic.

## Techniques used

### 1) Prime sieve
Generate all primes in the range \(1000<p<5000\) with a simple sieve of Eratosthenes.

### 2) Lucas’ theorem (binomial mod a prime)
For a prime \(p\):

\[
\binom{n}{k}\equiv \prod_i \binom{n_i}{k_i}\pmod p
\]

where \(n_i,k_i\) are the base-\(p\) digits of \(n,k\).
If any digit \(k_i>n_i\), the product is zero mod \(p\).

Each small digit binomial \(\binom{n_i}{k_i}\bmod p\) is computed using factorials modulo \(p\):

\[
\binom{a}{b}\equiv a!\,(b!)^{-1}\,((a-b)!)^{-1}\pmod p
\]

with modular inverses via Fermat’s little theorem \(x^{-1}\equiv x^{p-2}\pmod p\).

Because \(p\) is at most 4999, factorial tables up to \(p-1\) are small and fast to build.

### 3) Chinese Remainder Theorem (CRT) for three primes
For each triple \((p,q,r)\), we reconstruct the unique value \(x\) modulo \(pqr\) from:

- \(x \equiv a \pmod p\)
- \(x \equiv b \pmod q\)
- \(x \equiv c \pmod r\)

using a Garner-style two-step CRT:

1. Combine \((p,q)\) to get \(x_1 \bmod pq\)
2. Combine \(x_1\) with \(r\) to get \(x \bmod pqr\)

To make this fast over ~20.8 million triples, the code precomputes modular inverses
of each smaller prime modulo each larger prime.

## Complexity notes
- Computing all \(\binom{N}{K}\bmod p\) for the 501 primes is quick (factorials up to 5000).
- The main cost is iterating over all \(\binom{501}{3}=20{,}833{,}250\) prime triples, doing only a small constant amount of arithmetic per triple.

The program prints the final integer answer.
