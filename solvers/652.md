# Project Euler 652 Solution - Distinct Values of a Proto-logarithmic Function

<https://projecteuler.net/problem=652>:

* [652.py](652.py)

We need the number of **distinct** values a “proto-logarithmic” function can take on all integer pairs
\((m,n)\) with \(2 \le m,n \le N\). The note in the statement says that (assuming the four exponentials
conjecture) \(\log_m(n)\) is proto-logarithmic, so we can count distinct values of \(\log_m(n)\) by
counting the equivalence classes induced by the two rules in the statement.

---

## 1) Canonical form for integers: primitive root + maximal exponent

Every integer \(x \ge 2\) can be written **uniquely** as

\[
x = u^e
\]

where:

- \(u \ge 2\) is **not** a perfect power (a “primitive base”),
- \(e \ge 1\) is the **maximal** exponent (the greatest \(e\) such that \(x\) is an \(e\)-th power).

This decomposes the search space into a small set of possible exponents \(e \le \lfloor \log_2 N \rfloor\).

---

## 2) Rational values

If \(m\) and \(n\) share the same primitive base \(u\), i.e. \(m=u^e\) and \(n=u^f\), then

\[
\log_m(n) = \frac{f}{e}
\]

and the proto-log rules ensure that the value depends **only** on the reduced fraction \(f/e\), not on \(u\).

Let \(L=\lfloor\log_2 N\rfloor\). The distinct rational values are exactly the reduced fractions \(p/q\)
with \(1\le p,q\le L\). Their count is:

\[
R(N) = 2\sum_{k=1}^{L}\varphi(k) - 1
\]

(where \(\varphi\) is Euler’s totient function).

---

## 3) Irrational values and “primitive pairs”

If \(m\) and \(n\) do **not** share a primitive base, then proto-log equality can only come from
raising both numbers to the same power (rule 2 in the statement).

So each distinct irrational value is represented by an ordered pair \((m,n)\) such that:

- \(\gcd(e_m,e_n)=1\) where \(m=u^{e_m}\), \(n=v^{e_n}\) are written in maximal-exponent form,
- \(u \ne v\) (different primitive bases).

We count:

1. **All** ordered pairs with coprime maximal exponents:

\[
T = \sum_{\gcd(e,f)=1} \text{count}_e\cdot\text{count}_f
\]

where \(\text{count}_e\) is the number of integers \(\le N\) whose maximal exponent is \(e\).

2. Subtract those with the **same** primitive base (they are rational, not irrational).

For a fixed primitive base \(u\), the available exponents are \(1..K_u\) where
\(K_u=\lfloor\log_u N\rfloor\). The number of ordered coprime exponent pairs in \([1..K]^2\) is:

\[
C(K) = 2\sum_{k=1}^{K}\varphi(k) - 1
\]

We group primitive bases by the value of \(K_u\) and subtract:

\[
S = \sum_{K=1}^{L} \bigl(\#\{u : K_u=K\}\bigr)\cdot C(K)
\]

Then:

\[
I(N) = T - S
\]

and the final answer is:

\[
D(N) = R(N) + I(N)
\]

---

## 4) Counting primitive bases with Möbius inversion

To compute \(\text{count}_e\) and the grouping \(\#\{u:K_u=K\}\), we need:

\[
P(x) = \#\{u \le x : u \ge 2,\ u \text{ is not a perfect power}\}
\]

Let \(F(d) = \#\{n \in [2..x] : n \text{ is a } d\text{-th power}\} = \lfloor x^{1/d}\rfloor - 1\).

For \(n\ge2\), “being a \(d\)-th power” means the maximal exponent is a multiple of \(d\), so:

\[
F(d) = \sum_{d\mid k} G(k)
\]

Möbius inversion gives:

\[
G(1) = \sum_{d\ge 1}\mu(d)\,F(d)
\]

Thus:

\[
P(x) = \sum_{d=1}^{\lfloor\log_2 x\rfloor}\mu(d)\,\bigl(\lfloor x^{1/d}\rfloor - 1\bigr)
\]

This is fast because \(\lfloor\log_2 N\rfloor \le 59\) for \(N=10^{18}\).

---

## 5) Complexity

All computations are over \(e,f \le \lfloor\log_2 N\rfloor\) (at most 59),
so the runtime is \(O((\log N)^2)\) with tiny constants.

The program prints the last 9 digits of \(D(10^{18})\).
