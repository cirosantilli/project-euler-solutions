# Project Euler 367 Solution - Bozo Sort

<https://projecteuler.net/problem=367>:

* [367.py](367.py)

This problem asks for the expected number of *3-element shuffles* needed to sort a random permutation of `1..11`, where each step:

1. Checks whether the sequence is sorted (the identity permutation).
2. If not, picks **3 distinct positions uniformly** and applies a **uniform random permutation** of the chosen 3 elements (all `3! = 6` outcomes equally likely, including “no change”).

Because the input is averaged over all `11!` permutations, the starting distribution is **uniform over** `S₁₁`.

## Main ideas used

### 1) Markov chain as a random walk on `Sₙ`
The algorithm is a Markov chain on permutations. Each shuffle corresponds to multiplying the current permutation by a random element that:
- is the identity with probability `1/6`,
- is a transposition with total probability `1/2`,
- is a 3-cycle with total probability `1/3`.

This walk is **symmetric** (probability of `g` equals probability of `g⁻¹`) and **class-invariant** (depends only on cycle type), so it has a very clean spectral description.

### 2) Expected hitting time from the stationary (uniform) distribution
For a symmetric random walk on a finite group with **uniform stationary distribution**, the expected time to *hit the identity* when starting from uniform can be written purely in terms of irreducible representations:

\[
\mathbb{E}[T_{\text{id}}] \;=\; \sum_{\rho \neq \text{trivial}} \frac{d_\rho^2}{1-\lambda_\rho},
\]

where:
- `dρ` is the irrep dimension,
- `λρ` is the eigenvalue of the transition operator on that irrep.

So we never build the `11! × 11!` transition matrix.

### 3) Representation theory of `Sₙ` via partitions
Irreducible representations of `Sₙ` are indexed by integer partitions of `n`.
For each partition `λ` we need:
- the dimension `dλ` (hook-length formula),
- the normalized character ratios at a transposition and at a 3-cycle.

The eigenvalue for this problem is:

\[
\lambda_\lambda = \tfrac16 + \tfrac12 r_2(\lambda) + \tfrac13 r_3(\lambda),
\]
where `r₂ = χ(transposition)/d` and `r₃ = χ(3-cycle)/d`.

### 4) Characters for small cycles using Murnaghan–Nakayama
To get `χ(2,1^{n-2})` and `χ(3,1^{n-3})`, we use the **Murnaghan–Nakayama rule** specialized to a single `k`-cycle:

\[
\chi^\lambda(k,1^{n-k}) = \sum_{\text{rim hooks of size }k} (-1)^{\text{height}}\, f^{\nu},
\]

where removing that rim hook from `λ` leaves a smaller partition `ν`, and `f^ν` is its dimension.

Since `k ∈ {2,3}` and `n=11`, rim hooks can be enumerated by brute force over subsets of boxes (only up to `C(11,3)=165` candidates per partition).

### 5) Exact arithmetic
All values are computed with `fractions.Fraction`, so the final expectation is exact and only the very last step does rounding to the nearest integer.

## Sanity checks from the statement
The code includes asserts for the sample expectations when `n=4`:

- Original “swap two elements” bozo sort: `24.75 = 99/4`
- This problem’s 3-element shuffle variant: `27.5 = 55/2`
