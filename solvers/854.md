# Project Euler 854 Solution - Pisano Periods 2

<https://projecteuler.net/problem=854>:

* [854.py](854.py)

This repository contains a reference implementation for **Project Euler 854: _Pisano Periods 2_**.

## Core ideas

### 1) Pisano periods as a matrix order
Let
\[
Q=\begin{pmatrix}1&1\\1&0\end{pmatrix}.
\]
Then
\[
Q^k=\begin{pmatrix}F_{k+1}&F_k\\F_k&F_{k-1}\end{pmatrix},
\]
so the Fibonacci sequence modulo `n` repeats exactly when the pair \((F_k,F_{k+1})\) returns to \((0,1)\). Therefore
\[
\pi(n)=\min\{k>0: F_k\equiv 0\pmod n\ \text{and}\ F_{k+1}\equiv 1\pmod n\}.
\]

### 2) The “maximal modulus with period dividing p”
If a modulus `n` has period dividing `p`, then \(Q^p\equiv I\pmod n\), which forces
\(
F_p\equiv 0\pmod n
\)
and
\(
F_{p+1}\equiv 1\pmod n.
\)
So every such `n` divides
\[
N(p)=\gcd(F_p,\,F_{p+1}-1).
\]
Moreover, `N(p)` itself satisfies the same congruences, hence is the **largest** modulus whose Pisano period divides `p`.

### 3) Only a couple of odd periods exist
Because \(\det(Q)=-1\), we have \(\det(Q^k)=(-1)^k\). If `n>2` and \(Q^k\equiv I\pmod n\), then \((-1)^k\equiv 1\pmod n\) forces `k` to be even. Thus **for `n>2`, Pisano periods are even**, which implies:

- `M(p)=1` for all odd `p>3`.
- The only non-trivial odd case is `p=3`, where `M(3)=2`.

### 4) Closed form for even p
Write `p=2m`. Using Fibonacci/Lucas identities (including Cassini’s identity), one can show
\[
N(2m)=\gcd(F_{2m},F_{2m+1}-1)=\begin{cases}
F_m,& m\ \text{even}\\
L_m,& m\ \text{odd}
\end{cases}
\]
where `L_m` is the Lucas sequence (`L_0=2, L_1=1`).

Finally, these values actually achieve period `2m` (for `m>=3`), so for all even `p>=6`:
\[
M(p)=M(2m)=N(2m)=\begin{cases}
F_m,& m\ \text{even}\\
L_m,& m\ \text{odd}.
\end{cases}
\]

## Implementation strategy

- Use the formula above to avoid any factoring or Pisano-period computation.
- Iterate Fibonacci and Lucas recurrences **modulo** `1_234_567_891` up to index `500_000`.
- Multiply the appropriate term into the running product:
  - multiply `F_m` when `m` is even,
  - multiply `L_m` when `m` is odd,
  - also multiply `M(3)=2`.

This runs in `O(N)` time with `O(1)` memory.

## Sanity checks
The code asserts the values stated in the problem statement:

- `M(18) = 76`
- `P(10) = 264`
