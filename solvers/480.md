# Project Euler 480 Solution - The Last Question

<https://projecteuler.net/problem=480>:

* [480.py](480.py)

This solution computes **lexicographic ranks** and **lexicographic unranking** for words formed from a fixed **multiset of letters** (taken from the phrase in the problem) with a **maximum word length of 15**.

## Key techniques

### 1) Multiset word counting with a small DP
To rank/unrank, we constantly need:

> “How many distinct words can be formed from the remaining letters with up to `k` more characters?”

Let `dp[L]` be the number of distinct sequences of length `L` formable from the remaining multiset (letters are indistinguishable within a letter).

We build `dp` letter-type by letter-type.  
When we already have `dp[l]` sequences of length `l` from processed letters, and we add `t` copies of a new letter, the number of ways to interleave those `t` identical letters among `l + t` positions is:

- `C(l+t, t)`

So we update:

- `new[l+t] += dp[l] * C(l+t, t)` for `t = 0..count_of_letter`

Finally, the number of suffixes of length **0..k** (including the empty suffix) is:

- `sum(dp[0..k])`

Because `k ≤ 15`, this DP is extremely small and fast.

### 2) Memoization over multiset states
The counting function is called many times with different remaining letter counts during ranking and unranking.  
We memoize it with `lru_cache` using:

- `(counts_tuple, k)` as the cache key

This makes repeated subproblems essentially free.

### 3) Lexicographic rank `P(w)`
To compute the position of a word `w`:

- Walk left-to-right through the characters.
- At each position, try all smaller possible next letters and add the number of completions (all words starting with that smaller-prefix).
- Also add `1` for each proper prefix of `w`, because in dictionary order `"a" < "aa" < "aaa" ...`.

### 4) Lexicographic unranking `W(p)`
To recover the word at position `p`:

- Build the word character-by-character.
- Once the prefix is non-empty, the prefix itself is the next word (so “stop” is always considered first).
- Otherwise choose the smallest next letter whose block of completions contains `p`.

## Output
Running `python3 main.py` prints the final answer for the required expression and includes `assert` tests for the sample values given in the problem statement.
