# Project Euler 514 Solution - Geoboard Shapes

<https://projecteuler.net/problem=514>:

* [514.py](514.py)

## What the code computes

On an \((N+1)\times(N+1)\) lattice of pins (integer points \((x,y)\) with \(0\le x,y\le N\)), each pin is selected independently with probability \(p=\frac{1}{N+1}\). Let **S** be the convex hull of the selected pins. The task is to compute the expected area \(E(N)\) and output \(E(100)\) rounded to 5 decimal places.

The problem statement includes:
- \(E(1)=0.18750\)
- \(E(2)=0.94335\)
- \(E(10)=55.03013\)

The program asserts these (to 5 decimals, exactly as stated).

---

## Main techniques used

### 1) Linearity of expectation + shoelace (Green’s theorem) area
For a convex polygon with vertices \(v_i\) in counterclockwise order,
\[
\text{Area}=\frac12\sum_i \operatorname{cross}(v_i, v_{i+1})
\]
So the expected area is the sum of expected cross-product contributions of its edges.

### 2) Supporting lines by direction (half-plane emptiness)
Fix a primitive direction \(u=(a,b)\) with \(\gcd(a,b)=1\). Hull edges with this direction lie on a supporting line for a normal \((b,-a)\). Parallel lattice lines are indexed by
\[
t=b\,x-a\,y
\]
A line is the supporting line iff:
- no selected points occur on lines with larger \(t\), and
- at least one selected point occurs on a line with smaller \(t\).

With independent pin selection this yields a probability factor
\[
q^{\text{above}}\left(1-q^{\text{below}}\right),\quad q=1-p
\]
where `above`/`below` count lattice points with larger/smaller \(t\).

### 3) Closed-form expected boundary contribution per line
On a fixed line there are \(L\) lattice points. Consecutive selected points form hull edges. Summing over possible gaps \(d\) gives a small precomputable function:
\[
S(L)=\sum_{d=1}^{L-1} d(L-d)\,q^{d-1}
\]
Each line contributes in **O(1)** once \(L\) is known.

### 4) Enumerating all lines efficiently
For each direction \((a,b)\) in one octant, every parallel line is uniquely represented by a “start point” in:
- a left strip \(x<a\), and
- a bottom strip \(y<b\) for \(x\ge a\).

From that start point, \(L\) is computed by clamping to the square boundary.

### 5) 8-fold symmetry (D4) via centered coordinates
The square and random process are invariant under the dihedral symmetries of the square. The code enumerates primitive directions only in the octant \(a\ge b\ge 0\), then multiplies contributions by:
- 8 for general directions,
- 4 for axes/diagonals.

---

## Running

```bash
python3 main.py
```

Output:

```
8986.86698
```
