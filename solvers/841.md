# Project Euler 841 Solution - Regular Star Polygons

<https://projecteuler.net/problem=841>:

* [841.py](841.py)

This repo contains a **standard-library-only** solution.

The program computes

\[
\sum_{n=3}^{34} A(F_{n+1}, F_{n-1})
\]

and prints it rounded to **10 digits after the decimal point**.

## Main techniques

### 1) Start from the sector-integral / alternating-tangent formula
For a regular star polygon \(\{p/q\}\) scaled to inradius 1 (with \(p>2q\) and \(\gcd(p,q)=1\)), one can express the alternating shaded area as an integral over one \(2\pi/p\) sector.

Carrying out the integral produces a compact exact expression in terms of tangents (let \(s=\pi/p\)):

\[
A(p,q)=p\left(\tan(qs) + 2(-1)^q\sum_{k=1}^{q-1} (-1)^k\tan(ks)\right).
\]

### 2) Remove catastrophic cancellation by switching to “increment” terms
For the large Fibonacci inputs, the bracket above is about \(1/p\) and is formed by cancellation among \(O(q)\) terms of size \(O(1)\), which is numerically fragile.

The fix is to rewrite everything using the exact identity

\[
\tan(x)-\tan(x-s)=\frac{\sin s}{\cos x\,\cos(x-s)}.
\]

Define the **tangent increment**

\[
\Delta_k = \tan(ks)-\tan((k-1)s) = \frac{\sin s}{\cos(ks)\,\cos((k-1)s)}.
\]

Because \(\tan(qs)=\sum_{k=1}^q \Delta_k\), the alternating-tangent combination can be rearranged *exactly* into an alternating sum of these increments.

After simplification, the area becomes the well-conditioned form

\[
A(p,q) = (p\sin s)\sum_{k=1}^{q} (-1)^{k+q}\frac{1}{\cos(ks)\,\cos((k-1)s)}.
\]

Key benefit:
- \(p\sin(\pi/p)\) is \(\approx \pi\) (order 1)
- the remaining sum is also order 1
- we never subtract two huge nearly equal values

### 3) Numerical details
- **Direct cosine evaluation**: the implementation uses `math.cos(k*s)` each step (rather than a long sin/cos recurrence), which gives the best accuracy for millions of steps.
- **Kahan summation**: used for both the inner alternating sum and the final outer total.

### 4) Complexity
Computing one \(A(p,q)\) costs \(O(q)\) steps.

In this problem, \(q = F_{n-1}\), and
\(
\sum_{n=3}^{34} q = \sum_{k=2}^{33} F_k = F_{35}-2,
\)
so the total work is only about **nine million** loop iterations.

## Files

- `main.py` — solution + asserts for the two check values stated in the problem.
