# Project Euler 796 Solution - A Grand Shuffle

<https://projecteuler.net/problem=796>:

* [796.py](796.py)

This solution computes an expected stopping time when drawing cards **without replacement** from a shuffled multiset.

## Key techniques

- **Tail-sum formula for expectations**

  For a nonnegative integer-valued stopping time `T`:

  \[
  \mathbb{E}[T] = \sum_{k\ge 0} \Pr(T > k)
  \]

  Here, `Pr(T > k)` means: after `k` draws we **still** haven’t seen every required category.

- **Inclusion–exclusion on “missing categories”**

  “Not complete after `k` draws” means **at least one** required suit, rank, or deck design is missing.
  Inclusion–exclusion converts this union of events into a signed sum over intersections:

  - choose `a` suits to be missing,
  - choose `b` ranks to be missing,
  - choose `c` deck designs to be missing,

  and count how many cards are still allowed when those categories are forbidden.

- **Symmetry reduction**

  Suits are interchangeable, ranks are interchangeable, and deck designs are interchangeable.
  Therefore, the probability depends only on the **counts** `(a,b,c)`, not which specific suits/ranks/decks were chosen.
  This reduces an exponential subset enumeration to a small triple loop.

- **Hypergeometric counting via combination ratios**

  After `k` draws without replacement, the set of drawn cards is a uniform `k`-subset.
  If `M` cards are “allowed” (i.e., avoid the forbidden categories), then:

  \[
  \Pr(\text{all forbidden categories are missing after }k) = \frac{\binom{M}{k}}{\binom{N}{k}}
  \]

- **Fast recurrence for \(\binom{M}{k} / \binom{N}{k}\)**

  Direct binomial computation is huge. Instead, use:

  \[
  r_0 = 1,\quad
  r_k = r_{k-1}\cdot \frac{M-k+1}{N-k+1}
  \]

  where \(r_k = \binom{M}{k}/\binom{N}{k}\).
  Summing these ratios over `k=0..N-1` gives the tail-sum contribution for a fixed `M`.

## What the program does

- Verifies the numerical check value given in the statement for the 1-deck “all ranks” variant (rounded to 8 decimals).
- Computes the requested expectation for 10 decks and prints it rounded to 8 decimals.

## Running

```bash
python3 main.py
```
