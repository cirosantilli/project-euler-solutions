# Project Euler 356 Solution - Largest Roots of Cubic Polynomials

<https://projecteuler.net/problem=356>:

* [356.py](356.py)

We are given the cubic

\[
g_n(x)=x^3-2^n x^2+n
\]

Let \(a_n\) be its largest real root. The task is to find the last eight digits of

\[
\sum_{n=1}^{30}\left\lfloor a_n^{987654321}\right\rfloor.
\]

## Key idea: use power sums of *all* roots

Let the three roots of \(g_n(x)\) be \(r_1,r_2,r_3\), where \(r_1=a_n\) is the large one.
Define the **power sum**

\[
S_k = r_1^k+r_2^k+r_3^k.
\]

Because the polynomial is monic with integer coefficients, these power sums satisfy an **integer recurrence**, so every \(S_k\) is an integer.

From the root identity \(r^3 = 2^n r^2 - n\), multiplying by \(r^{k-3}\) gives:

\[
r^k = 2^n r^{k-1} - n r^{k-3}.
\]

Summing over the three roots:

\[
S_k = 2^n S_{k-1} - n S_{k-3}\quad (k\ge 3)
\]

with easy integer initial values:

- \(S_0 = 3\)
- \(S_1 = r_1+r_2+r_3 = 2^n\)
- \(S_2 = (r_1+r_2+r_3)^2 - 2(r_1r_2+r_1r_3+r_2r_3) = (2^n)^2\) (here the pairwise product sum is \(0\))

So \(S_k\) is an integer sequence generated by:

\[
S_0=3,\quad S_1=2^n,\quad S_2=(2^n)^2,\quad S_k=2^n S_{k-1}-n S_{k-3}.
\]

## Why the floor is just \(S_k-1\)

For \(n\ge 2\):

- \(g_n(0)=n>0\) and \(g_n(1)=1-2^n+n<0\), so there is a root in \((0,1)\).
- \(g_n(-1)=-1-2^n+n<0\) and \(g_n(0)>0\), so there is a root in \((-1,0)\).

Thus the other two roots satisfy \(|r_2|<1\) and \(|r_3|<1\). For the huge exponent \(k=987654321\),

\[
0 < r_2^k + r_3^k < 1,
\]

so:

\[
a_n^k = S_k - (r_2^k+r_3^k)
\]

lies strictly between \(S_k-1\) and \(S_k\). Therefore:

\[
\left\lfloor a_n^k \right\rfloor = S_k-1.
\]

For \(n=1\), the polynomial has a root exactly at \(1\), but because the exponent is **odd**, the same conclusion still holds: \(a_1^k\) is between \(S_k-1\) and \(S_k\).

So the whole problem becomes:

\[
\sum_{n=1}^{30} (S_{987654321}-1)\pmod{10^8}.
\]

## Computing \(S_k \bmod 10^8\) fast

The recurrence is linear, so we compute \(S_k\) modulo \(10^8\) using **3Ã—3 matrix exponentiation** in \(O(\log k)\) time per \(n\).

State:

\[
V_t = [S_t,S_{t-1},S_{t-2}]^T
\]

Transition:

\[
V_{t+1} =
\begin{pmatrix}
2^n & 0 & -n\\
1   & 0 & 0\\
0   & 1 & 0
\end{pmatrix}
V_t
\quad (\bmod 10^8)
\]

Then \(V_k = M^{k-2}V_2\) with \(V_2=[S_2,S_1,S_0]^T\).

Overall runtime is tiny: \(30 \times O(\log 987654321)\) matrix multiplications.

## Output

The program prints the last eight digits (zero-padded) of the required sum.
